---
date: 2021-12-09
aliases: []
---

# Metadata

**Title** :: MyBatis

**Author** :: #Matthew 

**Classification** :: #Learn #Java #Basic #MyBatis

**Status** :: #ğŸŒ±

**Type** :: #Note

**Previous** ::[[Study_Matthew/åˆ†å¸ƒå¼é›†ç¾¤æ¶æ§‹å ´æ™¯åŒ–è§£æ±ºæ–¹æ¡ˆ/3. ç¬¬ä¸‰éƒ¨åˆ† åˆ†ä½ˆå¼IDè§£æ±ºâ½…æ¡ˆ]]

**ParentNode** :: [[Study_Matthew/åˆ†å¸ƒå¼é›†ç¾¤æ¶æ§‹å ´æ™¯åŒ–è§£æ±ºæ–¹æ¡ˆ/åˆ†å¸ƒå¼é›†ç¾¤æ¶æ§‹å ´æ™¯åŒ–è§£æ±ºæ–¹æ¡ˆ]]

---

# ç¬¬å››éƒ¨åˆ†ï¼šåˆ†ä½ˆå¼èª¿åº¦å•é¡Œ

èª¿åº¦â€”>å®šæ™‚ä»»å‹™ï¼Œåˆ†ä½ˆå¼èª¿åº¦â€”>åœ¨åˆ†ä½ˆå¼é›†ç¾¤ç’°å¢ƒä¸‹å®šæ™‚ä»»å‹™é€™ä»¶äº‹

Elastic-jobï¼ˆå™¹å™¹â½¹é–‹æºçš„åˆ†ä½ˆå¼èª¿åº¦æ¡†æ¶ï¼‰

## ç¬¬ 1 ç¯€ å®šæ™‚ä»»å‹™çš„å ´æ™¯
å®šæ™‚ä»»å‹™å½¢å¼ï¼šæ¯éš”â¼€å®šæ™‚é–“/ç‰¹å®šæŸâ¼€æ™‚åˆ»åŸ·â¾

ä¾‹å¦‚ï¼š

- è¨‚å–®å¯©æ ¸ã€å‡ºåº«
- è¨‚å–®è¶…æ™‚â¾ƒå‹•å–æ¶ˆã€â½€ä»˜é€€æ¬¾
- ç¦®åˆ¸åŒæ­¥ã€â½£æˆã€ç™¼æ”¾ä½œæ¥­
- ç‰©æµä¿¡æ¯æ¨é€ã€æŠ“å–ä½œæ¥­ã€é€€æ›è²¨è™•ç†ä½œæ¥­
- æ•¸æ“šç©å£“ç›£æ§ã€â½‡å¿—ç›£æ§ã€æœå‹™å¯â½¤æ€§æ¢æ¸¬ä½œæ¥­
- å®šæ™‚å‚™ä»½æ•¸æ“š
- â¾¦èç³»çµ±æ¯å¤©çš„å®šæ™‚çµç®—
- æ•¸æ“šæ­¸æª”ã€æ¸…ç†ä½œæ¥­
- å ±è¡¨ã€é›¢ç·šæ•¸æ“šåˆ†æä½œæ¥­


## ç¬¬ 2 ç¯€ ä»€éº¼æ˜¯åˆ†ä½ˆå¼èª¿åº¦
ä»€éº¼æ˜¯åˆ†ä½ˆå¼ä»»å‹™èª¿åº¦ï¼Ÿæœ‰å…©å±¤å«ç¾©

1. é‹â¾åœ¨åˆ†ä½ˆå¼é›†ç¾¤ç’°å¢ƒä¸‹çš„èª¿åº¦ä»»å‹™ï¼ˆåŒâ¼€å€‹å®šæ™‚ä»»å‹™ç¨‹åºéƒ¨ç½²å¤šä»½ï¼Œåªæ‡‰è©²æœ‰â¼€å€‹å®šæ™‚ä»»å‹™åœ¨åŸ·â¾ï¼‰
2. åˆ†ä½ˆå¼èª¿åº¦â€”>å®šæ™‚ä»»å‹™çš„åˆ†ä½ˆå¼â€”>å®šæ™‚ä»»å‹™çš„æ‹†åˆ†ï¼ˆå³ç‚ºæŠŠâ¼€å€‹â¼¤çš„ä½œæ¥­ä»»å‹™æ‹†åˆ†ç‚ºå¤šå€‹â¼©çš„ä½œæ¥­ä»»å‹™ï¼ŒåŒæ™‚åŸ·â¾ï¼‰

![[Study_Matthew/åˆ†å¸ƒå¼é›†ç¾¤æ¶æ§‹å ´æ™¯åŒ–è§£æ±ºæ–¹æ¡ˆ/_annex/Pasted image 20211209142123.png]]

## ç¬¬ 3 ç¯€ å®šæ™‚ä»»å‹™èˆ‡æ¶ˆæ¯éšŠåˆ—çš„å€åˆ¥
- å…±åŒé»
	- ç•°æ­¥è™•ç†
		â½å¦‚è¨»å†Šã€ä¸‹å–®äº‹ä»¶
	- æ‡‰â½¤è§£è€¦
		ä¸ç®¡å®šæ™‚ä»»å‹™ä½œæ¥­é‚„æ˜¯MQéƒ½å¯ä»¥ä½œç‚ºå…©å€‹æ‡‰â½¤ä¹‹é–“çš„â»®è¼ªå¯¦ç¾æ‡‰â½¤è§£è€¦ï¼Œé€™å€‹â»®è¼ªå¯ä»¥ä¸­è½‰æ•¸æ“šï¼Œç•¶ç„¶å–®é«”æœå‹™ä¸éœ€è¦è€ƒæ…®é€™äº›ï¼Œæœå‹™æ‹†åˆ†çš„æ™‚å€™å¾€å¾€éƒ½æœƒè€ƒæ…®
	- æµé‡å‰Šå³°
		é›™â¼—â¼€çš„æ™‚å€™ï¼Œä»»å‹™ä½œæ¥­å’ŒMQéƒ½å¯ä»¥â½¤ä¾†æ‰›æµé‡ï¼Œå¾Œç«¯ç³»çµ±æ ¹æ“šæœå‹™èƒ½â¼’å®šæ™‚è™•ç†è¨‚å–®æˆ–è€…å¾MQæŠ“å–è¨‚å–®æŠ“å–åˆ°â¼€å€‹è¨‚å–®åˆ°ä¾†äº‹ä»¶çš„è©±è§¸ç™¼è™•ç†ï¼Œå°æ–¼å‰ç«¯â½¤æˆ¶ä¾†èªªçœ‹åˆ°çš„çµæœæ˜¯å·²ç¶“ä¸‹å–®æˆåŠŸäº†ï¼Œä¸‹å–®æ˜¯ä¸å—ä»»ä½•å½±éŸ¿çš„

- æœ¬è³ªä¸åŒ

å®šæ™‚ä»»å‹™ä½œæ¥­æ˜¯æ™‚é–“é©…å‹•ï¼Œâ½½MQæ˜¯äº‹ä»¶é©…å‹•ï¼›

æ™‚é–“é©…å‹•æ˜¯ä¸å¯ä»£æ›¿çš„ï¼Œâ½å¦‚â¾¦èç³»çµ±æ¯â½‡çš„åˆ©æ¯çµç®—ï¼Œä¸æ˜¯èªªåˆ©æ¯ä¾†â¼€æ¢ï¼ˆåˆ©æ¯åˆ°ä¾†äº‹ä»¶ï¼‰å°±ç®—

â¼€ä¸‹ï¼Œâ½½å¾€å¾€æ˜¯é€šéå®šæ™‚ä»»å‹™æ‰¹é‡è¨ˆç®—ï¼›

æ‰€ä»¥ï¼Œå®šæ™‚ä»»å‹™ä½œæ¥­æ›´å‚¾å‘æ–¼æ‰¹è™•ç†ï¼ŒMQå‚¾å‘æ–¼é€æ¢è™•ç†ï¼›


## ç¬¬ 4 ç¯€ å®šæ™‚ä»»å‹™çš„å¯¦ç¾â½…å¼
å®šæ™‚ä»»å‹™çš„å¯¦ç¾â½…å¼æœ‰å¤šç¨®ã€‚æ—©æœŸæ²’æœ‰å®šæ™‚ä»»å‹™æ¡†æ¶çš„æ™‚å€™ï¼Œæˆ‘å€‘æœƒä½¿â½¤JDKä¸­çš„Timeræ©Ÿåˆ¶å’Œå¤šç·šç¨‹æ©Ÿåˆ¶ï¼ˆRunnable+ç·šç¨‹ä¼‘çœ ï¼‰ä¾†å¯¦ç¾å®šæ™‚æˆ–è€…é–“éš”â¼€æ®µæ™‚é–“åŸ·â¾æŸâ¼€æ®µç¨‹åºï¼›å¾Œä¾†æœ‰äº†å®šæ™‚ä»»å‹™æ¡†æ¶ï¼Œâ½å¦‚â¼¤åé¼é¼çš„Quartzä»»å‹™èª¿åº¦æ¡†æ¶ï¼Œä½¿â½¤æ™‚é–“è¡¨é”å¼ï¼ˆåŒ…æ‹¬ï¼šç§’ã€åˆ†ã€æ™‚ã€â½‡ã€é€±ã€å¹´ï¼‰é…ç½®æŸâ¼€å€‹ä»»å‹™ä»€éº¼æ™‚é–“å»åŸ·â¾ï¼š

- ä»»å‹™èª¿åº¦æ¡†æ¶Quartzå›é¡§ç¤ºæ„(æˆ‘å€‘èª²ç¨‹ä¸»è¦å…§å®¹ä¸æ˜¯Quartz)

	- å¼•â¼Šjar
		```xml
		<!--ä»»åŠ¡è°ƒåº¦æ¡†æ¶quartz-->
		<!-- https://mvnrepository.com/artifact/org.quartz-scheduler/quartz --
		>
		<dependency>
		 <groupId>org.quartz-scheduler</groupId>
		 <artifactId>quartz</artifactId>
		 <version>2.3.2</version>
		</dependency>
		```

	- å®šæ™‚ä»»å‹™ä½œæ¥­ä¸»èª¿åº¦ç¨‹åº
	```java
	package quartz;
	import org.quartz.*;
	import org.quartz.impl.StdSchedulerFactory;
	public class QuartzMain {
	 // åˆ›å»ºä½œä¸šä»»åŠ¡è°ƒåº¦å™¨ï¼ˆç±»ä¼¼äºå…¬äº¤è°ƒåº¦ç«™ï¼‰
	 public static Scheduler createScheduler() throws SchedulerException {
	  SchedulerFactory schedulerFactory = new StdSchedulerFactory();
	  Scheduler scheduler = schedulerFactory.getScheduler();
	  return scheduler;
	 }
	 // åˆ›å»ºâ¼€ä¸ªä½œä¸šä»»åŠ¡ï¼ˆç±»ä¼¼äºâ¼€è¾†å…¬äº¤â»‹ï¼‰
	 public static JobDetail createJob() {
	  JobBuilder jobBuilder = JobBuilder.newJob(DemoJob.class);
	  jobBuilder.withIdentity("jobName","myJob");
	  JobDetail jobDetail = jobBuilder.build();
	  return jobDetail;
	 }
	 /**
	 * åˆ›å»ºä½œä¸šä»»åŠ¡æ—¶é—´è§¦å‘å™¨ï¼ˆç±»ä¼¼äºå…¬äº¤â»‹å‡ºâ»‹æ—¶é—´è¡¨ï¼‰
	 * cronè¡¨è¾¾å¼ç”±ä¸ƒä¸ªä½ç½®ç»„æˆï¼Œç©ºæ ¼åˆ†éš”
	 * 1ã€Secondsï¼ˆç§’ï¼‰ 0~59
	 * 2ã€Minutesï¼ˆåˆ†ï¼‰ 0~59
	 * 3ã€Hoursï¼ˆâ¼©æ—¶ï¼‰ 0~23
	 * 4ã€Day of Monthï¼ˆå¤©ï¼‰1~31,æ³¨æ„æœ‰çš„â½‰ä»½ä¸â¾œ31å¤©
	 * 5ã€Monthï¼ˆâ½‰ï¼‰ 0~11,æˆ–è€…
	JAN,FEB,MAR,APR,MAY,JUN,JUL,AUG,SEP,OCT,NOV,DEC
	 * 6ã€Day of Week(å‘¨) 1~7,1=SUNæˆ–è€… SUN,MON,TUE,WEB,THU,FRI,SAT
	 * 7ã€Yearï¼ˆå¹´ï¼‰1970~2099 å¯é€‰é¡¹
	 *ç¤ºä¾‹ï¼š
	 * 0 0 11 * * ? æ¯å¤©çš„11ç‚¹è§¦å‘æ‰§â¾â¼€æ¬¡
	 * 0 30 10 1 * ? æ¯â½‰1å·ä¸Šåˆ10ç‚¹åŠè§¦å‘æ‰§â¾â¼€æ¬¡
	 */
	 public static Trigger createTrigger() {
	  // åˆ›å»ºæ—¶é—´è§¦å‘å™¨ï¼ŒæŒ‰â½‡å†è°ƒåº¦
	  CronTrigger trigger = TriggerBuilder.newTrigger()
	  .withIdentity("triggerName","myTrigger")
	  .startNow()
	  .withSchedule(CronScheduleBuilder.cronSchedule("0/2 * * * * ?"))
	  .build();
	  // åˆ›å»ºè§¦å‘å™¨ï¼ŒæŒ‰ç®€å•é—´éš”è°ƒåº¦
	  /*SimpleTrigger trigger1 = TriggerBuilder.newTrigger()
	  .withIdentity("triggerName","myTrigger")
	  .startNow()
	  .withSchedule(SimpleScheduleBuilder
	  .simpleSchedule()
	  .withIntervalInSeconds(3)
	  .repeatForever())
	  .build();*/
	  return trigger;
	 }
	 // å®šæ—¶ä»»åŠ¡ä½œä¸šä¸»è°ƒåº¦ç¨‹åº
	 public static void main(String[] args) throws SchedulerException {
	  // åˆ›å»ºâ¼€ä¸ªä½œä¸šä»»åŠ¡è°ƒåº¦å™¨ï¼ˆç±»ä¼¼äºå…¬äº¤è°ƒåº¦ç«™ï¼‰
	  Scheduler scheduler = QuartzMain.createScheduler();
	  // åˆ›å»ºâ¼€ä¸ªä½œä¸šä»»åŠ¡ï¼ˆç±»ä¼¼äºâ¼€è¾†å…¬äº¤â»‹ï¼‰
	  JobDetail job = QuartzMain.createJob();
	  // åˆ›å»ºâ¼€ä¸ªä½œä¸šä»»åŠ¡æ—¶é—´è§¦å‘å™¨ï¼ˆç±»ä¼¼äºå…¬äº¤â»‹å‡ºâ»‹æ—¶é—´è¡¨ï¼‰
	  Trigger trigger = QuartzMain.createTrigger();
	  // ä½¿â½¤è°ƒåº¦å™¨æŒ‰ç…§æ—¶é—´è§¦å‘å™¨æ‰§â¾è¿™ä¸ªä½œä¸šä»»åŠ¡
	  scheduler.scheduleJob(job,trigger);
	  scheduler.start();
	 }
	}
	```

	- å®šç¾©â¼€å€‹jobï¼Œéœ€å¯¦ç¾Jobæ¥â¼
	```java
	package quartz;
	import org.quartz.Job;
	import org.quartz.JobExecutionContext;
	import org.quartz.JobExecutionException;
	public class DemoJob implements Job {
	 public void execute(JobExecutionContext jobExecutionContext) throws JobExecutionException {
	  System.out.println("æˆ‘æ˜¯â¼€ä¸ªå®šæ—¶ä»»åŠ¡é€»è¾‘");
	 }
	}
	```

ä»¥ä¸Šï¼Œæ˜¯å›é¡§â¼€ä¸‹ä»»å‹™èª¿åº¦æ¡†æ¶Quartzçš„â¼¤è‡´â½¤æ³•ï¼Œé‚£éº¼åœ¨åˆ†ä½ˆå¼æ¶æ§‹ç’°å¢ƒä¸­ä½¿â½¤Quartzå·²ç¶“ä¸èƒ½æ›´å¥½çš„æ»¿â¾œæˆ‘å€‘éœ€æ±‚ï¼Œæˆ‘å€‘å¯ä»¥ä½¿â½¤å°ˆæ¥­çš„åˆ†ä½ˆå¼èª¿åº¦æ¡†æ¶ï¼Œé€™â¾¥æˆ‘å€‘æ¨è–¦ä½¿â½¤Elastic-jobã€‚


## ç¬¬ 5 ç¯€ åˆ†ä½ˆå¼èª¿åº¦æ¡†æ¶Elastic-Job
### 5.1 Elastic-Jobä»‹ç´¹
Elastic-Jobæ˜¯å™¹å™¹â½¹é–‹æºçš„â¼€å€‹åˆ†ä½ˆå¼èª¿åº¦è§£æ±ºâ½…æ¡ˆï¼ŒåŸºæ–¼Quartzâ¼†æ¬¡é–‹ç™¼çš„ï¼Œç”±å…©å€‹ç›¸äº’ç¨â½´çš„â¼¦é …â½¬Elastic-Job-Liteå’ŒElastic-Job-Cloudçµ„æˆã€‚æˆ‘å€‘è¦å­¸ç¿’çš„æ˜¯ Elastic-Job-Liteï¼Œå®ƒå®šä½ç‚ºè¼•é‡ç´šâ½†ä¸­â¼¼åŒ–è§£æ±ºâ½…æ¡ˆï¼Œä½¿â½¤JaråŒ…çš„å½¢å¼æä¾›åˆ†ä½ˆå¼ä»»å‹™çš„å”èª¿æœå‹™ï¼Œâ½½Elastic-Job-Cloudâ¼¦é …â½¬éœ€è¦çµåˆMesosä»¥åŠDockeråœ¨é›²ç’°å¢ƒä¸‹ä½¿â½¤ã€‚

Elastic-Jobçš„githubåœ°å€ï¼šhttps://github.com/elasticjob

**ä¸»è¦åŠŸèƒ½ä»‹ç´¹**

- åˆ†ä½ˆå¼èª¿åº¦å”èª¿åœ¨åˆ†ä½ˆå¼ç’°å¢ƒä¸­ï¼Œä»»å‹™èƒ½å¤ æŒ‰æŒ‡å®šçš„èª¿åº¦ç­–ç•¥åŸ·â¾ï¼Œä¸¦ä¸”èƒ½å¤ é¿å…åŒâ¼€ä»»å‹™å¤šå¯¦ä¾‹é‡è¤‡åŸ·â¾

- è±å¯Œçš„èª¿åº¦ç­–ç•¥ åŸºæ–¼æˆç†Ÿçš„å®šæ™‚ä»»å‹™ä½œæ¥­æ¡†æ¶Quartz cronè¡¨é”å¼åŸ·â¾å®šæ™‚ä»»å‹™

- å½ˆæ€§æ“´å®¹ç¸®å®¹ ç•¶é›†ç¾¤ä¸­å¢åŠ æŸâ¼€å€‹å¯¦ä¾‹ï¼Œå®ƒæ‡‰ç•¶ä¹Ÿèƒ½å¤ è¢«é¸èˆ‰ä¸¦åŸ·â¾ä»»å‹™ï¼›ç•¶é›†ç¾¤æ¸›å°‘â¼€å€‹å¯¦ä¾‹æ™‚ï¼Œå®ƒæ‰€åŸ·â¾çš„ä»»å‹™èƒ½è¢«è½‰ç§»åˆ°åˆ¥çš„å¯¦ä¾‹ä¾†åŸ·â¾ã€‚

- å¤±æ•ˆè½‰ç§» æŸå¯¦ä¾‹åœ¨ä»»å‹™åŸ·â¾å¤±æ•—å¾Œï¼Œæœƒè¢«è½‰ç§»åˆ°å…¶ä»–å¯¦ä¾‹åŸ·â¾

- éŒ¯éåŸ·â¾ä½œæ¥­é‡è§¸ç™¼ è‹¥å› æŸç¨®åŸå› å°è‡´ä½œæ¥­éŒ¯éåŸ·â¾ï¼Œâ¾ƒå‹•è¨˜éŒ„éŒ¯éåŸ·â¾çš„ä½œæ¥­ï¼Œä¸¦åœ¨ä¸Šæ¬¡ä½œæ¥­å®Œæˆå¾Œâ¾ƒå‹•è§¸ç™¼ã€‚

- â½€æŒä¸¦â¾èª¿åº¦ â½€æŒä»»å‹™åˆ†â½šï¼Œä»»å‹™åˆ†â½šæ˜¯æŒ‡å°‡â¼€å€‹ä»»å‹™åˆ†ç‚ºå¤šå€‹â¼©ä»»å‹™é …åœ¨å¤šå€‹å¯¦ä¾‹åŒæ™‚åŸ·â¾ã€‚

- ä½œæ¥­åˆ†â½šâ¼€è‡´æ€§ ç•¶ä»»å‹™è¢«åˆ†â½šå¾Œï¼Œä¿è­‰åŒâ¼€åˆ†â½šåœ¨åˆ†ä½ˆå¼ç’°å¢ƒä¸­åƒ…â¼€å€‹åŸ·â¾å¯¦ä¾‹ã€‚


### 5.2 Elastic-Job-Liteæ‡‰â½¤

jaråŒ…ï¼ˆAPIï¼‰ + å®‰è£zkè»Ÿä»¶

Elastic-Jobä¾è³´æ–¼Zookeeperé€²â¾åˆ†ä½ˆå¼å”èª¿ï¼Œæ‰€ä»¥éœ€è¦å®‰è£Zookeeperè»Ÿä»¶ï¼ˆ3.4.6ç‰ˆæœ¬ä»¥ä¸Šï¼‰ï¼Œé—œæ–¼Zookeeperï¼Œæ­¤è™•æˆ‘å€‘ä¸åšè©³è§£ï¼Œåœ¨éšæ®µä¸‰æœƒæœ‰æ·±åº¦å­¸ç¿’ï¼Œæˆ‘å€‘æ­¤è™•éœ€è¦æ˜â½©Zookeeperçš„æœ¬è³ªåŠŸèƒ½ï¼šå­˜å„²+é€šçŸ¥ã€‚

- å®‰è£Zookeeperï¼ˆæ­¤è™•å–®ä¾‹é…ç½®ï¼‰

	1ï¼‰æˆ‘å€‘ä½¿â½¤3.4.10ç‰ˆæœ¬ï¼Œåœ¨linuxå¹³å°è§£å£“ä¸‹è¼‰çš„zookeeper-3.4.10.tar.gz

	2ï¼‰é€²â¼Šconfâ½¬éŒ„ï¼Œcp zoo_sample.cfg zoo.cfg

	3ï¼‰é€²â¼Šbinâ½¬éŒ„ï¼Œå•Ÿå‹•zkæœå‹™

	å•Ÿå‹• ./zkServer.sh start

	åœâ½Œ ./zkServer.sh stop

	æŸ¥çœ‹ç‹€æ…‹ ./zkServer.sh status

	**Zookeeperçš„æ¨¹å½¢ç¯€é»çµæ§‹åœ–**

	![[Study_Matthew/åˆ†å¸ƒå¼é›†ç¾¤æ¶æ§‹å ´æ™¯åŒ–è§£æ±ºæ–¹æ¡ˆ/_annex/Pasted image 20211209171336.png]]
	
- å¼•â¼ŠJaråŒ…
	```xml
	<!-- https://mvnrepository.com/artifact/com.dangdang/elastic-job-lite-core
	-->
	<dependency>
	 <groupId>com.dangdang</groupId>
	 <artifactId>elastic-job-lite-core</artifactId>
	 <version>2.1.5</version>
	</dependency>
	```

- å®šæ™‚ä»»å‹™å¯¦ä¾‹
	- éœ€æ±‚ï¼šæ¯éš”å…©ç§’é˜åŸ·â¾â¼€æ¬¡å®šæ™‚ä»»å‹™ï¼ˆresumeè¡¨ä¸­æœªæ­¸æª”çš„æ•¸æ“šæ­¸æª”åˆ°resume_bakè¡¨ä¸­ï¼Œæ¯æ¬¡æ­¸æª”1æ¢è¨˜éŒ„ï¼‰
	
	1ï¼‰resume_bakå’Œresumeè¡¨çµæ§‹å®Œå…¨â¼€æ¨£
	
	2ï¼‰resumeè¡¨ä¸­æ•¸æ“šæ­¸æª”ä¹‹å¾Œä¸åˆªé™¤ï¼Œåªå°‡stateç½®ç‚º"å·²æ­¸æª”"
	
	- æ•¸æ“šè¡¨çµæ§‹
	```sql
	-- ----------------------------
	-- Table structure for resume
	-- ----------------------------
	DROP TABLE IF EXISTS `resume`;
	CREATE TABLE `resume` (
	 `id` bigint(20) NOT NULL AUTO_INCREMENT,
	 `name` varchar(255) DEFAULT NULL,
	 `sex` varchar(255) DEFAULT NULL,
	 `phone` varchar(255) DEFAULT NULL,
	 `address` varchar(255) DEFAULT NULL,
	 `education` varchar(255) DEFAULT NULL,
	 `state` varchar(255) DEFAULT NULL,
	 PRIMARY KEY (`id`)
	) ENGINE=InnoDB AUTO_INCREMENT=1001 DEFAULT CHARSET=utf8;
	SET FOREIGN_KEY_CHECKS = 1;
	```
	
	- ç¨‹åºé–‹ç™¼
		- å®šæ™‚ä»»å‹™é¡
			```java
			package elasticjob;
			import com.dangdang.ddframe.job.api.ShardingContext;
			import com.dangdang.ddframe.job.api.simple.SimpleJob;
			import util.JdbcUtil;
			import java.sql.Connection;
			import java.sql.PreparedStatement;
			import java.sql.ResultSet;
			import java.util.List;
			import java.util.Map;
			public class BackupJob implements SimpleJob {
			 // å®šæ—¶ä»»åŠ¡æ¯æ‰§â¾â¼€æ¬¡éƒ½ä¼šæ‰§â¾å¦‚ä¸‹çš„é€»è¾‘
			 @Override
			 public void execute(ShardingContext shardingContext) {
			  /*
			  ä»resumeæ•°æ®è¡¨æŸ¥æ‰¾1æ¡æœªå½’æ¡£çš„æ•°æ®ï¼Œå°†å…¶å½’æ¡£åˆ°resume_bakè¡¨ï¼Œå¹¶æ›´æ–°çŠ¶æ€ä¸ºå·²å½’æ¡£ï¼ˆä¸åˆ é™¤åŸæ•°æ®ï¼‰
			  */
			  // æŸ¥è¯¢å‡ºâ¼€æ¡æ•°æ®
			  String selectSql = "select * from resume where	state='æœªå½’æ¡£' limit 1";
			  List<Map<String, Object>> list = JdbcUtil.executeQuery(selectSql);
			  if(list == null || list.size() == 0) {
			   return;
			  }
			  Map<String, Object> stringObjectMap = list.get(0);
			  long id = (long) stringObjectMap.get("id");
			  String name = (String) stringObjectMap.get("name");
			  String education = (String) stringObjectMap.get("education");
			  // æ‰“å°å‡ºè¿™æ¡è®°å½•
			  System.out.println("======>>>idï¼š" + id + " nameï¼š" + name + " educationï¼š" + education);
			  // æ›´æ”¹çŠ¶æ€
			  String updateSql = "update resume set state='å·²å½’æ¡£' where id=?";
			  JdbcUtil.executeUpdate(updateSql,id);
			  // å½’æ¡£è¿™æ¡è®°å½•
			  String insertSql = "insert into resume_bak select * from resume where id=?";
			  JdbcUtil.executeUpdate(insertSql,id);
			 }
			}
			```

		- ä¸»é¡
			```java
			package elasticjob;
			import com.dangdang.ddframe.job.config.JobCoreConfiguration;
			import com.dangdang.ddframe.job.config.simple.SimpleJobConfiguration;
			import com.dangdang.ddframe.job.lite.api.JobScheduler;
			import com.dangdang.ddframe.job.lite.config.LiteJobConfiguration;
			import com.dangdang.ddframe.job.reg.base.CoordinatorRegistryCenter;
			import com.dangdang.ddframe.job.reg.zookeeper.ZookeeperConfiguration;
			import com.dangdang.ddframe.job.reg.zookeeper.ZookeeperRegistryCenter;
			public class ElasticJobMain {
			 public static void main(String[] args) {
			  // é…ç½®æ³¨å†Œä¸­â¼¼zookeeperï¼Œzookeeperåè°ƒè°ƒåº¦ï¼Œä¸èƒ½è®©ä»»åŠ¡é‡å¤æ‰§â¾ï¼Œé€šè¿‡å‘½åç©ºé—´åˆ†ç±»ç®¡ç†ä»»åŠ¡ï¼Œå¯¹åº”åˆ°zookeeperçš„â½¬å½•
			  ZookeeperConfiguration zookeeperConfiguration = new ZookeeperConfiguration("localhost:2181","data-archive-job");
			  CoordinatorRegistryCenter coordinatorRegistryCenter = new ZookeeperRegistryCenter(zookeeperConfiguration);
			  coordinatorRegistryCenter.init();
			  // é…ç½®ä»»åŠ¡
			  JobCoreConfiguration jobCoreConfiguration = JobCoreConfiguration.newBuilder("archive-job","*/2 * * * * ?",1).build();
			  SimpleJobConfiguration simpleJobConfiguration = new SimpleJobConfiguration(jobCoreConfiguration,BackupJob.class.getName());
			  // å¯åŠ¨ä»»åŠ¡
			  new JobScheduler(coordinatorRegistryCenter,LiteJobConfiguration.newBuilder(simpleJobConfiguration).build()).init();
			 }
			}
			```

		- JdbcUtilâ¼¯å…·é¡
			```java
			package util;
			import java.sql.*;
			import java.util.ArrayList;
			import java.util.HashMap;
			import java.util.List;
			import java.util.Map;
			public class JdbcUtil {
			 //url
			 private static String url = "jdbc:mysql://localhost:3306/job?characterEncoding=utf8&useSSL=false";
			 //user
			 private static String user = "root";
			 //password
			 private static String password = "123456";
			 //é©±åŠ¨ç¨‹åºç±»
			 private static String driver = "com.mysql.jdbc.Driver";
			 static {
			  try {
			   Class.forName(driver);
			  } catch (ClassNotFoundException e) {
			   // TODO Auto-generated catch block
			   e.printStackTrace();
			  }
			 }
			 
			 public static Connection getConnection() {
			 
			 try {
			  return DriverManager.getConnection(url, user, password);
			 } catch (SQLException e) {
			  // TODO Auto-generated catch block
			  e.printStackTrace();
			 }
			  return null;
			 }
				
			 public static void close(ResultSet rs, PreparedStatement ps, Connection con) {
			  if (rs != null) {
			   try {
			    rs.close();
			   } catch (SQLException e) {
			    // TODO Auto-generated catch block
			    e.printStackTrace();
			   } finally {
			    if (ps != null) {
			     try {
			      ps.close();
			     } catch (SQLException e) {
			      // TODO Auto-generated catch block
			      e.printStackTrace();
			     } finally {
			      if (con != null) {
			       try {
			        con.close();
			       } catch (SQLException e) {
			        // TODO Auto-generated catch block
			        e.printStackTrace();
			       }
			      }
			     }
			    }
			   }
			  }
			 }

			 public static void executeUpdate(String sql,Object...obj) {
			  Connection con = getConnection();
			  PreparedStatement ps = null;
			  try {
			   ps = con.prepareStatement(sql);
			   for (int i = 0; i < obj.length; i++) {
			    ps.setObject(i + 1, obj[i]);
			   }
			   ps.executeUpdate();
			  } catch (SQLException e) {
			   // TODO Auto-generated catch block
			   e.printStackTrace();
			  } finally {
			   close(null, ps, con);
			  }
			 }

			 public static List<Map<String,Object>> executeQuery(String sql, Object...obj) {
			  Connection con = getConnection();
			  ResultSet rs = null;
			  PreparedStatement ps = null;
			  try {
			   ps = con.prepareStatement(sql);
			   for (int i = 0; i < obj.length; i++) {
			    ps.setObject(i + 1, obj[i]);
			   }
			   rs = ps.executeQuery();

			   List<Map<String, Object>> list = new ArrayList<>();

			   int count = rs.getMetaData().getColumnCount();

			   while (rs.next()) {

			   Map<String, Object> map = new HashMap<String, Object>();
			   for (int i = 0; i < count; i++) {
			    Object ob = rs.getObject(i + 1);
			    String key = rs.getMetaData().getColumnName(i + 1);
			    map.put(key, ob);
			   }
			   list.add(map); 
			  }  
			 return list;
			 } catch (SQLException e) {
			  // TODO Auto-generated catch block
			  e.printStackTrace();
			 } finally {
			  close(rs, ps, con);
			 }
			  return null;
			 }
			}
			```

	- æ¸¬è©¦
	
	1ï¼‰å¯å…ˆå•Ÿå‹•â¼€å€‹é€²ç¨‹ï¼Œç„¶å¾Œå†å•Ÿå‹•â¼€å€‹é€²ç¨‹ï¼ˆå…©å€‹é€²ç¨‹æ¨¡æ“¬åˆ†ä½ˆå¼ç’°å¢ƒä¸‹ï¼Œé€šâ¼€å€‹å®šæ™‚ä»»å‹™éƒ¨ç½²äº†å…©ä»½åœ¨â¼¯ä½œï¼‰

	2ï¼‰å…©å€‹é€²ç¨‹é€å€‹å•Ÿå‹•ï¼Œè§€å¯Ÿç¾è±¡

	3ï¼‰é—œé–‰å…¶ä¸­åŸ·â¾çš„é€²ç¨‹ï¼Œè§€å¯Ÿç¾è±¡

	- Leaderç¯€é»é¸èˆ‰æ©Ÿåˆ¶

	æ¯å€‹Elastic-Jobçš„ä»»å‹™åŸ·â¾å¯¦ä¾‹Appä½œç‚ºZookeeperçš„å®¢æˆ¶ç«¯ä¾†æ“ä½œZooKeeperçš„znode

	ï¼ˆ1ï¼‰å¤šå€‹å¯¦ä¾‹åŒæ™‚å‰µå»º/leaderç¯€é»

	ï¼ˆ2ï¼‰/leaderç¯€é»åªèƒ½å‰µå»ºâ¼€å€‹ï¼Œå¾Œå‰µå»ºçš„æœƒå¤±æ•—ï¼Œå‰µå»ºæˆåŠŸçš„å¯¦ä¾‹æœƒè¢«é¸ç‚ºleaderç¯€é»ï¼ŒåŸ·â¾ä»»å‹™


### 5.4 Elastic-Job-Liteè¼•é‡ç´šå»ä¸­â¼¼åŒ–çš„ç‰¹é»

å¦‚ä½•ç†è§£è¼•é‡ç´šå’Œå»ä¸­â¼¼åŒ–ï¼Ÿ

![[Study_Matthew/åˆ†å¸ƒå¼é›†ç¾¤æ¶æ§‹å ´æ™¯åŒ–è§£æ±ºæ–¹æ¡ˆ/_annex/Pasted image 20211209173544.png]]


### 5.5 ä»»å‹™åˆ†â½š
â¼€å€‹â¼¤çš„â¾®å¸¸è€—æ™‚çš„ä½œæ¥­Jobï¼Œâ½å¦‚ï¼šâ¼€æ¬¡è¦è™•ç†â¼€å„„çš„æ•¸æ“šï¼Œé‚£é€™â¼€å„„çš„æ•¸æ“šå­˜å„²åœ¨æ•¸æ“šåº«ä¸­ï¼Œå¦‚æœâ½¤â¼€å€‹ä½œæ¥­ç¯€é»è™•ç†â¼€å„„æ•¸æ“šè¦å¾ˆä¹…ï¼Œåœ¨äº’è¯â½¹é ˜åŸŸæ˜¯ä¸å¤ªèƒ½æ¥å—çš„ï¼Œäº’è¯â½¹é ˜åŸŸæ›´å¸Œæœ›æ©Ÿå™¨çš„å¢åŠ å»æ©«å‘æ“´å±•è™•ç†èƒ½â¼’ã€‚æ‰€ä»¥ï¼ŒElasticJobå¯ä»¥æŠŠä½œæ¥­åˆ†ç‚ºå¤šå€‹çš„taskï¼ˆæ¯â¼€å€‹taskå°±æ˜¯â¼€å€‹ä»»å‹™åˆ†â½šï¼‰ï¼Œæ¯â¼€å€‹taskäº¤çµ¦å…·é«”çš„â¼€å€‹æ©Ÿå™¨å¯¦ä¾‹å»è™•ç†ï¼ˆâ¼€å€‹æ©Ÿå™¨å¯¦ä¾‹æ˜¯å¯ä»¥è™•ç†å¤šå€‹taskçš„ï¼‰ï¼Œä½†æ˜¯å…·é«”æ¯å€‹taskåŸ·â¾ä»€éº¼é‚è¼¯ç”±æˆ‘å€‘â¾ƒâ¼°ä¾†æŒ‡å®šã€‚

![[Study_Matthew/åˆ†å¸ƒå¼é›†ç¾¤æ¶æ§‹å ´æ™¯åŒ–è§£æ±ºæ–¹æ¡ˆ/_annex/Pasted image 20211209173622.png]]

Strategyç­–ç•¥å®šç¾©é€™äº›åˆ†â½šé …æ€éº¼å»åˆ†é…åˆ°å„å€‹æ©Ÿå™¨ä¸Šå»ï¼Œé»˜èªæ˜¯å¹³å‡å»åˆ†ï¼Œå¯ä»¥å®šåˆ¶ï¼Œâ½å¦‚æŸâ¼€å€‹æ©Ÿå™¨è² è¼‰ â½è¼ƒâ¾¼æˆ–è€…é é…ç½®â½è¼ƒâ¾¼ï¼Œé‚£éº¼å°±å¯ä»¥å¯«ç­–ç•¥ã€‚åˆ†â½šå’Œä½œæ¥­æœ¬èº«æ˜¯é€šéâ¼€å€‹è¨»å†Šä¸­â¼¼å”èª¿çš„ï¼Œå› ç‚ºåœ¨åˆ†ä½ˆå¼ç’°å¢ƒä¸‹ï¼Œç‹€æ…‹æ•¸æ“šè‚¯å®šé›†ä¸­åˆ°â¼€é»ï¼Œæ‰å¯ä»¥åœ¨åˆ†ä½ˆå¼ä¸­æºé€šã€‚

**åˆ†â½šä»£ç¢¼**

![[Study_Matthew/åˆ†å¸ƒå¼é›†ç¾¤æ¶æ§‹å ´æ™¯åŒ–è§£æ±ºæ–¹æ¡ˆ/_annex/Pasted image 20211209173708.png]]

![[Study_Matthew/åˆ†å¸ƒå¼é›†ç¾¤æ¶æ§‹å ´æ™¯åŒ–è§£æ±ºæ–¹æ¡ˆ/_annex/Pasted image 20211209173722.png]]


### 5.6 å½ˆæ€§æ“´å®¹

![[Study_Matthew/åˆ†å¸ƒå¼é›†ç¾¤æ¶æ§‹å ´æ™¯åŒ–è§£æ±ºæ–¹æ¡ˆ/_annex/Pasted image 20211209173747.png]]

æ–°å¢åŠ â¼€å€‹é‹â¾å¯¦ä¾‹app3ï¼Œå®ƒæœƒâ¾ƒå‹•è¨»å†Šåˆ°è¨»å†Šä¸­â¼¼ï¼Œè¨»å†Šä¸­â¼¼ç™¼ç¾æ–°çš„æœå‹™ä¸Šç·šï¼Œè¨»å†Šä¸­â¼¼æœƒé€šçŸ¥ElasticJob é€²â¾é‡æ–°åˆ†â½šï¼Œé‚£éº¼ç¸½å¾—åˆ†â½šé …æœ‰å¤šå°‘ï¼Œé‚£éº¼å°±å¯ä»¥æå¤šå°‘å€‹å¯¦ä¾‹æ©Ÿå™¨ï¼Œâ½å¦‚å®Œå…¨å¯ä»¥åˆ†1000â½š

æœ€å¤šå°±å¯ä»¥æœ‰å¤šå°‘appå¯¦ä¾‹ï¼Œï¼Œï¼Œï¼Œæ©Ÿå™¨èƒ½æˆçš„ä¸»ï¼Œå®Œå…¨å¯ä»¥åˆ†1000â½š

é‚£éº¼å°±å¯ä»¥æ1000å°æ©Ÿå™¨â¼€èµ·åŸ·â¾ä½œæ¥­

æ³¨æ„ï¼š

1ï¼‰åˆ†â½šé …ä¹Ÿæ˜¯â¼€å€‹JOBé…ç½®ï¼Œä¿®æ”¹é…ç½®ï¼Œé‡æ–°åˆ†â½šï¼Œåœ¨ä¸‹â¼€æ¬¡å®šæ™‚é‹â¾ä¹‹å‰æœƒé‡æ–°èª¿â½¤åˆ†â½šç®—æ³•ï¼Œé‚£éº¼é€™å€‹åˆ†â½šç®—æ³•çš„çµæœå°±æ˜¯ï¼šå“ªå°æ©Ÿå™¨é‹â¾å“ªâ¼€å€‹â¼€â½šï¼Œé€™å€‹çµæœå­˜å„²åˆ°zkä¸­çš„ï¼Œä¸»ç¯€é»æœƒæŠŠåˆ†â½šçµ¦åˆ†å¥½æ”¾åˆ°è¨»å†Šä¸­â¼¼å»ï¼Œç„¶å¾ŒåŸ·â¾ç¯€é»å¾è¨»å†Šä¸­â¼¼ç²å–ä¿¡æ¯(åŸ·â¾ç¯€é»åœ¨å®šæ™‚ä»»å‹™é–‹å•Ÿçš„æ™‚å€™ç²å–ç›¸æ‡‰çš„åˆ†â½š)ã€‚

2ï¼‰å¦‚æœæ‰€æœ‰çš„ç¯€é»æ›æ‰å€¼å‰©ä¸‹â¼€å€‹ç¯€é»ï¼Œæ‰€æœ‰åˆ†â½šéƒ½æœƒæŒ‡å‘å‰©ä¸‹çš„â¼€å€‹ç¯€é»ï¼Œé€™ä¹Ÿæ˜¯ElasticJobçš„â¾¼å¯â½¤ã€‚


