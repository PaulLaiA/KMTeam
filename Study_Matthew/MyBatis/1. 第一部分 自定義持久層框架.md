---
date: 2021-11-04
aliases: ["è‡ªå®šç¾©æŒä¹…å±¤æ¡†æ¶"]
---

# Metadata

**Title** :: è‡ªå®šç¾©æŒä¹…å±¤æ¡†æ¶

**Author** :: #Matthew 

**Classification** :: #Learn #Java #Basic

**Status** :: #ğŸŒ±

**Type** :: #Note

**Previous** ::

**ParentNode** :: [[Study_Matthew/MyBatis/MyBatis|MyBatis]]

---

# ç¬¬ä¸€éƒ¨åˆ†ï¼šè‡ªå®šç¾©æŒä¹…å±¤æ¡†æ¶
## 1.1 åˆ†æ JDBC æ“ä½œå•é¡Œ

```java
public static void main(String[] args) {
 	Connection connection = null;
 	PreparedStatement preparedStatement = null;
 	ResultSet resultSet = null;
	try {
		// åŠ è½½æ•°æ®åº“é©±åŠ¨
		Class.forName("com.mysql.jdbc.Driver");
		// é€šè¿‡é©±åŠ¨ç®¡ç†ç±»è·å–æ•°æ®åº“é“¾æ¥
		connection = DriverManager.getConnection("jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8", "root", "root");
		// å®šä¹‰ sql è¯­å¥ï¼Ÿè¡¨ç¤ºå ä½ç¬¦
		String sql = "select * from user where username = ?";
		// è·å–é¢„å¤„ç† statement
		preparedStatement = connection.prepareStatement(sql);
		// è®¾ç½®å‚æ•°ï¼Œç¬¬â¼€ä¸ªå‚æ•°ä¸º sql è¯­å¥ä¸­å‚æ•°çš„åºå·(ä» 1 å¼€å§‹)ï¼Œç¬¬â¼†ä¸ªå‚æ•°ä¸ºè®¾ç½®çš„å‚æ•°å€¼
		preparedStatement.setString(1, "tom");
		// å‘æ•°æ®åº“å‘å‡º sql æ‰§â¾æŸ¥è¯¢ï¼ŒæŸ¥è¯¢å‡ºç»“æœé›†
		resultSet = preparedStatement.executeQuery();
		// éå†æŸ¥è¯¢ç»“æœé›†
		while (resultSet.next()) {
			int id = resultSet.getInt("id");
			String username = resultSet.getString("username");
			// å°è£… User
			user.setId(id);
			user.setUsername(username);
		}
			System.out.println(user);
		}
	} catch (Exception e) {
		e.printStackTrace();
	} finally {
		// é‡Šæ”¾èµ„æº
		if (resultSet != null) {
            try {
                resultSet.close();
            } catch (SQLException e) {
                e.printStackTrace();
			}
		}
		if (preparedStatement != null) {
			try {
			preparedStatement.close();
			} catch (SQLException e) {
			e.printStackTrace();
			}
		}
		if (connection != null) {
			try {
				connection.close();
			} catch (SQLException e) {
				e.printStackTrace();
			}
		}
}

```

JDBC å•é¡Œç¸½çµï¼š
åŸå§‹ jdbc é–‹ç™¼å­˜åœ¨çš„å•é¡Œå¦‚ä¸‹ï¼š
1. æ•¸æ“šåº«é€£æ¥å‰µå»ºã€é‡‹æ”¾é »ç¹é€ æˆç³»çµ±è³‡æºæµªè²»ï¼Œå¾â½½å½±éŸ¿ç³»çµ±æ€§èƒ½ã€‚
2. Sql èªå¥åœ¨ä»£ç¢¼ä¸­ç¡¬ç·¨ç¢¼ï¼Œé€ æˆä»£ç¢¼ä¸æ˜“ç¶­è­·ï¼Œå¯¦éš›æ‡‰â½¤ä¸­ sql è®ŠåŒ–çš„å¯èƒ½è¼ƒâ¼¤ï¼Œsql è®Šå‹•éœ€è¦æ”¹è®Š java ä»£ç¢¼ã€‚
3. ä½¿â½¤ preparedStatement å‘ä½”æœ‰ä½ç¬¦è™Ÿå‚³åƒæ•¸å­˜åœ¨ç¡¬ç·¨ç¢¼ï¼Œå› ç‚º sql èªå¥çš„ where æ¢ä»¶ä¸â¼€å®šï¼Œå¯èƒ½ å¤šä¹Ÿå¯èƒ½å°‘ï¼Œä¿®æ”¹ sql é‚„è¦ä¿®æ”¹ä»£ç¢¼ï¼Œç³»çµ±ä¸æ˜“ç¶­è­·ã€‚
4. å°çµæœé›†è§£æå­˜åœ¨ç¡¬ç·¨ç¢¼(æŸ¥è©¢åˆ—å)ï¼Œsql è®ŠåŒ–å°è‡´è§£æä»£ç¢¼è®ŠåŒ–ï¼Œç³»çµ±ä¸æ˜“ç¶­è­·ï¼Œå¦‚æœèƒ½å°‡æ•¸æ“š åº«è¨˜éŒ„å°è£æˆ pojo å°è±¡è§£æâ½è¼ƒâ½…ä¾¿

## 1.2 å•é¡Œè§£æ±ºæ€è·¯
1. ä½¿ç”¨æ•¸æ“šåº«é€£æ¥æ± åˆå§‹åŒ–é€£æ¥è³‡æº
2. å°‡ sql èªå¥æŠ½å–åˆ° xml é…ç½®æ–‡ä»¶ä¸­
3. ä½¿ç”¨åå°„ã€å…§çœç­‰åº•å±¤æŠ€è¡“ã€è‡ªå‹•å°‡å¯¦é«”èˆ‡è¡¨é€²è¡Œå±¬æ€§èˆ‡å­—æ®µçš„è‡ªå‹•æ˜ å°„

## 1.3 è‡ªè¨‚ç¾©æ¡†æ¶è¨­è¨ˆ
- ä½¿â½¤ç«¯ï¼š
		æä¾›æ ¸â¼¼é…ç½®â½‚ä»¶ï¼š
		sqlMapConfig.xml : å­˜æ”¾æ•¸æ“šæºä¿¡æ¯ï¼Œå¼•â¼Š mapper.xml
		Mapper.xml : sql èªå¥çš„é…ç½®â½‚ä»¶ä¿¡æ¯

 - æ¡†æ¶ç«¯ï¼š
1. è®€å–é…ç½®â½‚ä»¶
		è®€å–å®Œæˆä»¥å¾Œä»¥æµçš„å½¢å¼å­˜åœ¨ï¼Œæˆ‘å€‘ä¸èƒ½å°‡è®€å–åˆ°çš„é…ç½®ä¿¡æ¯ä»¥æµçš„å½¢å¼å­˜æ”¾åœ¨å…§å­˜ä¸­ï¼Œä¸å¥½æ“ä½œï¼Œå¯ä»¥å‰µå»º javaBean ä¾†å­˜å„²
		ï¼ˆ1ï¼‰Configuration : å­˜æ”¾æ•¸æ“šåº«åŸºæœ¬ä¿¡æ¯ã€Map< å”¯â¼€æ¨™è­˜ï¼ŒMapper> å”¯â¼€æ¨™è­˜ï¼šnamespace + "." + id
		ï¼ˆ2ï¼‰MappedStatementï¼šsql èªå¥ã€statement é¡å‹ã€è¼¸â¼Šåƒæ•¸ java é¡å‹ã€è¼¸å‡ºåƒæ•¸ java é¡å‹
2. è§£æé…ç½®â½‚ä»¶
		å‰µå»º sqlSessionFactoryBuilder é¡ï¼š
		â½…æ³•ï¼šsqlSessionFactory build()ï¼š
		ç¬¬â¼€ï¼šä½¿â½¤ dom4j è§£æé…ç½®â½‚ä»¶ï¼Œå°‡è§£æå‡ºä¾†çš„å…§å®¹å°è£åˆ° Configuration å’Œ MappedStatement ä¸­
		ç¬¬â¼†ï¼šå‰µå»º SqlSessionFactory çš„å¯¦ç¾é¡ DefaultSqlSession
3. å‰µå»º SqlSessionFactoryï¼š
		â½…æ³•ï¼šopenSession() : ç²å– sqlSession æ¥â¼çš„å¯¦ç¾é¡å¯¦ä¾‹å°è±¡
4. å‰µå»º sqlSession æ¥â¼åŠå¯¦ç¾é¡ï¼šä¸»è¦å°è£ crud â½…æ³•
		â½…æ³•ï¼šselectList(String statementId,Object param)ï¼šæŸ¥è©¢æ‰€æœ‰
		selectOne(String statementId,Object param)ï¼šæŸ¥è©¢å–®å€‹
		å…·é«”å¯¦ç¾ï¼šå°è£ JDBC å®Œæˆå°æ•¸æ“šåº«è¡¨çš„æŸ¥è©¢æ“ä½œ
		
 - æ¶‰åŠåˆ°çš„è¨­è¨ˆæ¨¡å¼ï¼š
		Builder æ§‹å»ºè€…è¨­è¨ˆæ¨¡å¼ã€â¼¯â¼šæ¨¡å¼ã€ä»£ç†æ¨¡å¼
		
## 1.4 è‡ªå®šç¾©æ¡†æ¶å¯¦ç¾
åœ¨ä½¿ç”¨ç«¯é …ç›®ä¸­å‰µå»ºè‡ªå®šç¾©é…ç½®æ–‡ä»¶

å‰µå»º sqlMapConfig.xml
```xml
<configuration>
<!--æ•°æ®åº“è¿æ¥ä¿¡æ¯-->
 <property name="driverClass" value="com.mysql.jdbc.Driver"></property>
 <property name="jdbcUrl" value="jdbc:mysql:///zdy_mybatis"></property>
 <property name="username" value="root"></property>
 <property name="password" value="root"></property>
 <! --å¼•â¼Š sql é…ç½®ä¿¡æ¯-->
 <mapper resource="mapper.xml"></mapper>
</configuration>
```

mapper.xml
```xml
<mapper namespace="User">
 <select id="selectOne" paramterType="com.lagou.pojo.User" resultType="com.lagou.pojo.User">
 	select * from user where id = #{id} and username =#{username}
 </select>
 
 <select id="selectList" resultType="com.lagou.pojo.User">
 	select * from user
 </select>
</mapper>
```

User å¯¦é«”
```java
public class User {
 //ä¸»é”®æ ‡è¯†
 private Integer id;
 //â½¤æˆ·å
 private String username;
 
 public Integer getId() {
 	return id;
 }
 	public void setId(Integer id) {
 	this.id = id;
 }
 public String getUsername() {
 	return username;
 }
 public void setUsername(String username) {
 	this.username = username;
 }
 @Override
 public String toString() {
	 return "User{" +
	 "id=" + id +
	 ", username='" + username + '\'' + '}';
 }
}
```

å†å‰µå»ºä¸€å€‹ Maven å­å·¥ç¨‹ä¸¦ä¸”å°å…¥éœ€è¦ç”¨åˆ°çš„ä¾è³´åˆ¤æ–·
```xml
<properties>
 <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
 <maven.compiler.encoding>UTF-8</maven.compiler.encoding>
 <java.version>1.8</java.version>
 <maven.compiler.source>1.8</maven.compiler.source>
 <maven.compiler.target>1.8</maven.compiler.target>
</properties>
<dependencies>
 <dependency>
 <groupId>mysql</groupId>
 <artifactId>mysql-connector-java</artifactId>
 <version>5.1.17</version>
 </dependency>
 
 <dependency>
 <groupId>c3p0</groupId>
 <artifactId>c3p0</artifactId>
 <version>0.9.1.2</version>
 </dependency>
 
 <dependency>
 <groupId>log4j</groupId>
 <artifactId>log4j</artifactId>
 <version>1.2.12</version>
 </dependency>
 
 <dependency>
 <groupId>junit</groupId>
 <artifactId>junit</artifactId>
 <version>4.10</version>
 </dependency>
 
 <dependency>
 <groupId>dom4j</groupId>
 <artifactId>dom4j</artifactId>
 <version>1.6.1</version>
 </dependency>
 
 <dependency>
 <groupId>jaxen</groupId>
 <artifactId>jaxen</artifactId>
 <version>1.1.6</version>
 </dependency>
</dependencies>
```

Configuration
```java
public class Configuration {
 //æ•°æ®æº
 private DataSource dataSource;
 //map é›†åˆï¼š key:statementId value:MappedStatement
 private Map<String,MappedStatement> mappedStatementMap = new HashMap<String,MappedStatement>();
 public DataSource getDataSource() {
 return dataSource;
}
 public void setDataSource(DataSource dataSource) {
 this.dataSource = dataSource;
}
 public Map<String, MappedStatement> getMappedStatementMap() {
 return mappedStatementMap;
}
 public void setMappedStatementMap(Map<String, MappedStatement> mappedStatementMap) {
 this.mappedStatementMap = mappedStatementMap;
}
}
```

MappedStatement
```java
public class MappedStatement {
	//id
	private Integer id;
	//sql è¯­å¥
	private String sql;
	//è¾“â¼Šå‚æ•°
	private Class<?> paramterType;
	//è¾“å‡ºå‚æ•°
	private Class<?> resultType;
	public Integer getId() {
		return id;
	}
	public void setId(Integer id) {
		this.id = id;
	}
	public String getSql() {
		return sql;
	}
	public void setSql(String sql) {
		this.sql = sql;
	}
	public Class<?> getParamterType() {
		return paramterType; 
	} 
	public void setParamterType(Class<?> paramterType) {
		this.paramterType = paramterType;
	}
	public Class<?> getResultType() {
		return resultType;
	}
	public void setResultType(Class<?> resultType) {
		this.resultType = resultType;
	}
}
```

Resources
```java
public class Resources {
	public static InputStream getResourceAsSteam(String path){ 
	InputStream	resourceAsStream =	Resources.class.getClassLoader.getResourceAsStream(path);
		return resourceAsStream;
	}
}
```

SqlSessionFactoryBuilder
```java
public class SqlSessionFactoryBuilder {
	private Configuration configuration;
	public SqlSessionFactoryBuilder() {
		this.configuration = new Configuration();
	}
	public SqlSessionFactory build(InputStream inputStream) throws DocumentException, PropertyVetoException, ClassNotFoundException {
		//1.è§£æé…ç½®â½‚ä»¶ï¼Œå°è£… Configuration 
		XMLConfigerBuilder xmlConfigerBuilder = new XMLConfigerBuilder(configuration);
		Configuration configuration = xmlConfigerBuilder.parseConfiguration(inputStream);
		//2.åˆ›å»º sqlSessionFactory
		SqlSessionFactory sqlSessionFactory = new	DefaultSqlSessionFactory(configuration);
		return sqlSessionFactory;
 }
```

XMLConfigerBuilder
```java
public class XMLConfigerBuilder {
	private Configuration configuration;
	public XMLConfigerBuilder(Configuration configuration) {
		this.configuration = new Configuration();
	}
	public Configuration parseConfiguration(InputStream inputStream) throws	DocumentException, PropertyVetoException, ClassNotFoundException {
		Document document = new SAXReader().read(inputStream); //<configuation>
		Element rootElement = document.getRootElement();
		List<Element> propertyElements = rootElement.selectNodes("//property");
		Properties properties = new Properties();
		for (Element propertyElement : propertyElements) {
			String name = propertyElement.attributeValue("name");
			String value = propertyElement.attributeValue("value");
			properties.setProperty(name,value);
		}
		//è¿æ¥æ± 
		ComboPooledDataSource comboPooledDataSource = new	ComboPooledDataSource();
		comboPooledDataSource.setDriverClass(properties.getProperty("driverClass"));
		comboPooledDataSource.setJdbcUrl(properties.getProperty("jdbcUrl"));
		comboPooledDataSource.setUser(properties.getProperty("username"));
		comboPooledDataSource.setPassword(properties.getProperty("password"));
		//å¡«å…… configuration
		configuration.setDataSource(comboPooledDataSource);
		//mapper éƒ¨åˆ†
		List<Element> mapperElements = rootElement.selectNodes("//mapper");
		XMLMapperBuilder xmlMapperBuilder = new XMLMapperBuilder(configuration);
		for (Element mapperElement : mapperElements) {
			String mapperPath = mapperElement.attributeValue("resource");
			InputStream resourceAsSteam =	Resources.getResourceAsSteam(mapperPath);
			xmlMapperBuilder.parse(resourceAsSteam);
		}
		return configuration;
	}
}
```

XMLMapperBuilder
```java
public class XMLMapperBuilder {
	private Configuration configuration;
	public XMLMapperBuilder(Configuration configuration) {
		this.configuration = configuration;
	}
	public void parse(InputStream inputStream) throws DocumentException, ClassNotFoundException {
		Document document = new SAXReader().read(inputStream);
		Element rootElement = document.getRootElement();
		String namespace = rootElement.attributeValue("namespace");
		List<Element> select = rootElement.selectNodes("select");
		for (Element element : select) { //id çš„å€¼
			String id = element.attributeValue("id");
			String paramterType = element.attributeValue("paramterType");
			String resultType = element.attributeValue("resultType"); //è¾“â¼Šå‚æ•° class
			Class<?> paramterTypeClass = getClassType(paramterType);
			//è¿”å›ç»“æœ class
			Class<?> resultTypeClass = getClassType(resultType);
			//statementId
			String key = namespace + "." + id;
			//sql è¯­å¥
			String textTrim = element.getTextTrim();
			//å°è£… mappedStatement
			MappedStatement mappedStatement = new MappedStatement();
			mappedStatement.setId(id);
			mappedStatement.setParamterType(paramterTypeClass);
			mappedStatement.setResultType(resultTypeClass);
			mappedStatement.setSql(textTrim);
			//å¡«å…… configuration
			configuration.getMappedStatementMap().put(key, mappedStatement);
			private Class<?> getClassType (String paramterType) throws ClassNotFoundException {
				Class<?> aClass = Class.forName(paramterType);
				return aClass;
			}
		}
	}
}
```

sqlSessionFactory æ¥å£åŠ DefaultSqlSessionFactory å¯¦ç¾é¡
```java
public interface SqlSessionFactory {
	public SqlSession openSession();
}

public class DefaultSqlSessionFactory implements SqlSessionFactory {
	private Configuration configuration;
	public DefaultSqlSessionFactory(Configuration configuration) { 
 		this.configuration =configuration;
	}
	public SqlSession openSession(){
		return new DefaultSqlSession(configuration);
	}
}
```

sqlSession æ¥â¼åŠ DefaultSqlSession å¯¦ç¾é¡
```java
public interface SqlSession {
	public <E> List<E> selectList(String statementId, Object... param) Exception;
	public <T> T selectOne(String statementId,Object... params) throws Exception;
	public void close() throws SQLException;
}
```

```java
public class DefaultSqlSession implements SqlSession {
	private Configuration configuration;
	public DefaultSqlSession(Configuration configuration) {
	this.configuration = configuration;
	//å¤„ç†å™¨å¯¹è±¡
	private Executor simpleExcutor = new SimpleExecutor();
	public <E > List < E > selectList(String statementId, Object...param) throws Exception {
		MappedStatement mappedStatement = configuration.getMappedStatementMap().get(statementId);
		List<E> query = simpleExcutor.query(configuration, mappedStatement, param);
		return query;
	}
	//selectOne ä¸­è°ƒâ½¤ selectList
	public <T > T selectOne(String statementId, Object...params) throws Exception {
		List<Object> objects = selectList(statementId, params);
		if (objects.size() == 1) {
			return (T) objects.get(0);
		} else {
			throw new RuntimeException("è¿”å›ç»“æœè¿‡å¤š");
		}
	}
	public void close () throws SQLException {
		simpleExcutor.close();
	}
}
```

Executor
```java
public interface Executor {
 <E> List<E> query(Configuration configuration, MappedStatement	mappedStatement,Object[] param) throws Exception;
 	void close() throws SQLException;
}
```

SimpleExecutor
```java
public class SimpleExecutor implements Executor {
 private Connection connection = null;
 public <E> List<E> query(Configuration configuration, MappedStatement mappedStatement, Object[] param) throws SQLException, NoSuchFieldException,
IllegalAccessException, InstantiationException, IntrospectionException, InvocationTargetException {
 //è·å–è¿æ¥
 connection = configuration.getDataSource().getConnection();
 // select * from user where id = #{id} and username = #{username} String sql =
mappedStatement.getSql();
 //å¯¹ sql è¿›â¾å¤„ç†
 BoundSql boundsql = getBoundSql(sql);
 // select * from where id = ? and username = ?
 String finalSql = boundsql.getSqlText();
 //è·å–ä¼ â¼Šå‚æ•°ç±»å‹
 Class<?> paramterType = mappedStatement.getParamterType();
 //è·å–é¢„ç¼–è¯‘ preparedStatement å¯¹è±¡
 PreparedStatement preparedStatement = connection.prepareStatement(finalSql);
 List<ParameterMapping> parameterMappingList = boundsql.getParameterMappingList();
 for (int i = 0; i < parameterMappingList.size(); i++) {
 ParameterMapping parameterMapping = parameterMappingList.get(i);
 String name = parameterMapping.getName();
 //åå°„
 Field declaredField = paramterType.getDeclaredField(name);
 declaredField.setAccessible(true);
 //å‚æ•°çš„å€¼
 Object o = declaredField.get(param[0]);
 //ç»™å ä½ç¬¦èµ‹å€¼
 preparedStatement.setObject(i + 1, o);
 }
 ResultSet resultSet = preparedStatement.executeQuery();
 Class<?> resultType = mappedStatement.getResultType();
 ArrayList<E> results = new ArrayList<E>();
 while (resultSet.next()) {
 ResultSetMetaData metaData = resultSet.getMetaData();
 (E) resultType.newInstance();
 int columnCount = metaData.getColumnCount();
 for (int i = 1; i <= columnCount; i++) {
 //å±æ€§å
 String columnName = metaData.getColumnName(i);
 //å±æ€§å€¼
 Object value = resultSet.getObject(columnName);
 //åˆ›å»ºå±æ€§æè¿°å™¨ï¼Œä¸ºå±æ€§â½£æˆè¯»å†™â½…æ³•
 PropertyDescriptor propertyDescriptor = new PropertyDescriptor(columnName, resultType);
 //è·å–å†™â½…æ³•
 Method writeMethod = propertyDescriptor.getWriteMethod();
 //å‘ç±»ä¸­å†™â¼Šå€¼
 writeMethod.invoke(o, value);
 }
 results.add(o);
 }
 return results;
 }
 @Override
 public void close() throws SQLException {
 connection.close();
 }
 private BoundSql getBoundSql(String sql) {
 //æ ‡è®°å¤„ç†ç±»ï¼šä¸»è¦æ˜¯é…åˆé€šâ½¤æ ‡è®°è§£æå™¨ GenericTokenParser ç±»å®Œæˆå¯¹é…ç½®â½‚ä»¶ç­‰çš„è§£ æâ¼¯ä½œï¼Œå…¶ä¸­ TokenHandler ä¸»è¦å®Œæˆå¤„ç†
 ParameterMappingTokenHandler parameterMappingTokenHandler = new ParameterMappingTokenHandler();
 //GenericTokenParser :é€šâ½¤çš„æ ‡è®°è§£æå™¨ï¼Œå®Œæˆäº†ä»£ç â½šæ®µä¸­çš„å ä½ç¬¦çš„è§£æï¼Œç„¶åå†æ ¹ æ®ç»™å®šçš„æ ‡è®°å¤„ç†å™¨(TokenHandler)æ¥è¿›â¾è¡¨è¾¾å¼çš„å¤„ç†
 //ä¸‰ä¸ªå‚æ•°ï¼šåˆ†åˆ«ä¸º openToken (å¼€å§‹æ ‡è®°)ã€closeToken (ç»“æŸæ ‡è®°)ã€handler (æ ‡è®°å¤„ ç†å™¨)
 GenericTokenParser genericTokenParser = new GenericTokenParser("# {", "}", parameterMappingTokenHandler);
 String parse = genericTokenParser.parse(sql);
 List<ParameterMapping> parameterMappings = parameterMappingTokenHandler.getParameterMappings();
 BoundSql boundSql = new BoundSql(parse, parameterMappings);
 return boundSql;
 }
}
```

BoundSql
```java
public class BoundSql {
	//è§£æè¿‡åçš„ sql è¯­å¥
	private String sqlText;
	//è§£æå‡ºæ¥çš„å‚æ•°
	private List<ParameterMapping> parameterMappingList = new	ArrayList<ParameterMapping>();
	public BoundSql(String sqlText, List<ParameterMapping> parameterMappingList) {
		this.sqlText = sqlText;
		this.parameterMappingList = parameterMappingList;
	}
	public String getSqlText() {
		return sqlText;
	}
	public void setSqlText(String sqlText) {
		this.sqlText = sqlText;
	}
	public List<ParameterMapping> getParameterMappingList() {
		return parameterMappingList;
	}
	public void setParameterMappingList(List<ParameterMapping> parameterMappingList) {
		this.parameterMappingList = parameterMappingList;
	}
}
```

## 1.5 â¾ƒå®šç¾©æ¡†æ¶å„ªåŒ–
é€šéä¸Šè¿°æˆ‘å€‘çš„â¾ƒå®šç¾©æ¡†æ¶ï¼Œæˆ‘å€‘è§£æ±ºäº† JDBC æ“ä½œæ•¸æ“šåº«å¸¶ä¾†çš„â¼€äº›å•é¡Œï¼šä¾‹å¦‚é »ç¹å‰µå»ºé‡‹æ”¾æ•¸æ“šåº«é€£ æ¥ï¼Œç¡¬ç·¨
ç¢¼ï¼Œâ¼¿å‹•å°è£è¿”å›çµæœé›†ç­‰å•é¡Œï¼Œä½†æ˜¯ç¾åœ¨æˆ‘å€‘ç¹¼çºŒä¾†åˆ†æå‰›å‰›å®Œæˆçš„â¾ƒå®šç¾©æ¡†æ¶ä»£ç¢¼ï¼Œæœ‰æ²’ æœ‰ä»€éº¼å•é¡Œï¼Ÿ
å•é¡Œå¦‚ä¸‹ï¼š
- dao çš„å¯¦ç¾é¡ä¸­å­˜åœ¨é‡è¤‡çš„ä»£ç¢¼ï¼Œæ•´å€‹æ“ä½œçš„éç¨‹æ¨¡æ¿é‡è¤‡(å‰µå»º sqlsession,èª¿â½¤ sqlsession â½… æ³•ï¼Œé—œé–‰ sqlsession)
- dao çš„å¯¦ç¾é¡ä¸­å­˜åœ¨ç¡¬ç·¨ç¢¼ï¼Œèª¿â½¤ sqlsession çš„â½…æ³•æ™‚ï¼Œåƒæ•¸ statement çš„ id ç¡¬ç·¨ç¢¼

è§£æ±ºï¼šä½¿â½¤ä»£ç†æ¨¡å¼ä¾†å‰µå»ºæ¥â¼çš„ä»£ç†å°è±¡
```java
@Test
 public void test2() throws Exception {
	 InputStream resourceAsSteam = Resources.getResourceAsSteam(pathï¼š"sqlMapConfig.xml")
	 SqlSessionFactory build = new SqlSessionFactoryBuilder().build(resourceAsSteam);
	 SqlSession sqlSession = build.openSession();
	 User user = new User();
	 user.setld(l);
	 user.setUsername("tom");
	 //ä»£ç†å¯¹è±¡
	 UserMapper userMapper = sqlSession.getMappper(UserMapper.class);
	 User userl = userMapper.selectOne(user);
	 Systemãƒ»out.println(userl);
 }

```

åœ¨ sqlSession ä¸­æ·»åŠ â½…æ³•
```java
public interface SqlSession {
	public <T> T getMappper(Class<?> mapperClass);
}
```

å¯¦ç¾é¡
```java
@Override
 public <T> T getMappper(Class<?> mapperClass) {
 T o = (T) Proxy.newProxyInstance(mapperClass.getClassLoader(), new Class[] {mapperClass}, new InvocationHandler() {
	 @Override
	 public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
		 // selectOne
		 String methodName = method.getName();
		 // className:namespace
		 String className = method.getDeclaringClass().getName();
		 //statementid
		 String key = className+"."+methodName;
		 MappedStatement mappedStatement = configuration.getMappedStatementMap().get(key);
		 Type genericReturnType = method.getGenericReturnType();
		 ArrayList arrayList = new ArrayList<> ();
		 //åˆ¤æ–­æ˜¯å¦å®ç°æ³›å‹ç±»å‹å‚æ•°åŒ–
		 if(genericReturnType instanceof ParameterizedType){
			 return selectList(key,args);
			 return selectOne(key,args);
		 }
	 });
	 return o;
 }
```

