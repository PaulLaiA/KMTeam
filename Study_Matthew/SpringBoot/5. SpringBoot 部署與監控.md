---
date: 2021-11-14
aliases: []
---

# Metadata

**Title** :: MyBatis

**Author** :: #Matthew 

**Classification** :: #Learn #Java #Basic #MyBatis #SpringFramework/#SpringBoot 

**Status** :: #ğŸŒ±

**Type** :: #Note

**Previous** ::

**ParentNode** :: [[Study_Matthew/SpringBoot/SpringBoot]]

---


# 5. SpringBoot éƒ¨ç½²èˆ‡ç›£æ§

## 5.1 SpringBoot é …ç›®éƒ¨ç½²

ç›®å‰ï¼Œå‰å¾Œç«¯åˆ†é›¢çš„æ¶æ§‹å·²æˆä¸»æµï¼Œè€Œä½¿ç”¨SpringBootæ§‹å»ºWebæ‡‰ç”¨æ˜¯éå¸¸å¿«é€Ÿçš„ï¼Œé …ç›®ç™¼ä½ˆåˆ°æœå‹™å™¨ä¸Šçš„æ™‚å€™ï¼Œåªéœ€è¦æ‰“æˆä¸€å€‹jaråŒ…ï¼Œç„¶å¾Œé€šéå‘½ä»¤ : java -jar jaråŒ…åç¨±å³å¯å•Ÿå‹•æœå‹™äº†ã€‚

### 5.1.1 jaråŒ…(å®˜æ–¹æ¨è–¦)

SpringBooté …ç›®é»˜èªæ‰“åŒ…æˆjaråŒ…
![[Pasted image 20211114211544.png]]

	jaråŒ…æ–¹å¼å•Ÿå‹•ï¼Œä¹Ÿå°±æ˜¯ä½¿ç”¨SpringBootå…§ç½®çš„tomcaté‹è¡Œã€‚æœå‹™å™¨ä¸Šé¢åªè¦ä½ é…ç½®äº†jdk1.8åŠä»¥ä¸Šå°±okï¼Œä¸éœ€è¦å¤–ç½®tomcatã€‚

1ã€SpringBootå°‡é …ç›®æ‰“åŒ…æˆjaråŒ…

a.é¦–å…ˆåœ¨pom.xmlæ–‡ä»¶ä¸­å°å…¥Springbootçš„mavenä¾è³´
```xml
<!--å°†åº”ç”¨æ‰“åŒ…æˆä¸€ä¸ªå¯ä»¥æ‰§è¡Œçš„jaråŒ…-->
<build>
	<plugins>
		<plugin>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-maven-plugin</artifactId>
		</plugin>
	</plugins>
```

b.åŸ·è¡Œpackage

![[Pasted image 20211114211838.png]]

c.packageå®Œæˆä»¥å,targetä¸­ä¼šç”Ÿæˆä¸€ä¸ª.jaråŒ…;
![[Pasted image 20211114211906.png]]

d.å¯ä»¥å°‡jaråŒ…ä¸Šå‚³åˆ°Linuxæœå‹™å™¨ä¸Šï¼Œä»¥jaré‹è¡Œï¼ˆæ­¤è™•æœ¬åœ°é©—è­‰æ‰“åŒ…æˆåŠŸï¼‰
```cmd
java -jar spring-boot-mytest-0.0.1-SNAPSHOT.jar
```

![[Pasted image 20211114211937.png]]

### 5.1.2 waråŒ…
å‚³çµ±çš„éƒ¨ç½²æ–¹å¼ï¼šå°‡é …ç›®æ‰“æˆwaråŒ…ï¼Œæ”¾å…¥tomcat çš„webappsç›®éŒ„ä¸‹é¢ï¼Œå•Ÿå‹•tomcatï¼Œå³å¯è¨ªå•ã€‚

SpringBooté …ç›®æ”¹é€ æ‰“åŒ…æˆwarçš„æµç¨‹

1ã€pom.xmlé…ç½®ä¿®æ”¹
```xml
<packaging>jar</packaging>
//ä¿®æ”¹ä¸º
<packaging>war</packaging>
```

2ã€pomæ–‡ä»¶æ·»åŠ å¦‚äº›ä¾è³´
```xml
<!--æ·»åŠ servlet-apiçš„ä¾èµ–,ç”¨æ¥æ‰“waråŒ… -->
<dependency>
	<groupId>javax.servlet</groupId>
	<artifactId>javax.servlet-api</artifactId>
	<scope>provided</scope>
</dependency>
```

3ã€æ’é™¤springbootå…§ç½®çš„tomcatå¹²æ“¾
```xml
<!--æœ€ç»ˆæ‰“æˆwaråŒ…ï¼Œæ’é™¤å†…ç½®çš„tomcat-->
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-web</artifactId>
	<exclusions>
		<exclusion>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-starter-tomcat</artifactId>
		</exclusion>
	</exclusions>
</dependency>
```

4ã€æ”¹é€ å•Ÿå‹•é¡

å¦‚æœæ˜¯waråŒ…ç™¼å¸ƒï¼Œéœ€è¦å¢åŠ SpringBootServletInitializerå­é¡ï¼Œä¸¦é‡å¯«å…¶configureæ–¹æ³•ï¼Œæˆ–è€…å°‡mainå‡½æ•¸æ‰€åœ¨çš„é¡ç¹¼æ‰¿SpringBootServletInitializerï¼Œä¸¦é‡å¯«configureæ–¹æ³•

ç•¶æ™‚æ‰“åŒ…ç‚ºwaræ™‚ä¸Šå‚³åˆ°tomcatæœå‹™å™¨ä¸­è¨ªå•é …ç›®å§‹çµ‚å ±404éŒ¯å°±æ˜¯å¿½ç•¥äº†é€™å€‹æ­¥é©Ÿï¼ ï¼ ï¼

**æ”¹é€ ä¹‹å‰ï¼š**
```java
@SpringBootApplication
public class MainApp {
	public static void main(String[] args) {
		SpringApplication.run(MainApp.class,args);
	}
}
```

**æ”¹é€ ä¹‹å¾Œï¼š**
```java
@SpringBootApplication
public class SpringBootMytestApplication extends
SpringBootServletInitializer {
	public static void main(String[] args) {
		SpringApplication.run(SpringBootMytestApplication.class, args);
	}
	@Override
	protected SpringApplicationBuilder configure(SpringApplicationBuilder	builder) {
		// æ³¨æ„è¿™é‡Œè¦æŒ‡å‘åŸå…ˆç”¨mainæ–¹æ³•æ‰§è¡Œçš„Applicationå¯åŠ¨ç±»
		return builder.sources(SpringBootMytestApplication.class);
	}
```

é€™ç¨®æ”¹é€ æ–¹å¼ä¹Ÿæ˜¯å®˜æ–¹æ¯”è¼ƒæ¨è–¦çš„æ–¹æ³•

5ã€pomæ–‡ä»¶ä¸­ä¸è¦å¿˜äº†mavenç·¨è­¯æ’ä»¶
```xml
<build>
	<plugins>
		<plugin>
			<groupId>org.springframework.boot</groupId>
			<artifactId>spring-boot-maven-plugin</artifactId>
		</plugin>
	</plugins>
</build>
```

6ã€åœ¨IDEAä¸­ä½¿ç”¨mvn cleanå‘½ä»¤æ¸…é™¤èˆŠçš„åŒ…ï¼Œä¸¦ä½¿ç”¨mvn packageç”Ÿæˆæ–°çš„waråŒ…
![[Pasted image 20211114212428.png]]

åŸ·è¡Œå®Œç•¢å¾Œï¼Œå¯ä»¥çœ‹åˆ°waråŒ…å·²ç¶“ç”Ÿæˆäº†ï¼Œé»˜èªæ˜¯åœ¨targetç›®éŒ„ä¸‹ï¼Œä½ç½®å¯ä»¥åœ¨pomæ–‡ä»¶ä¸­é€²è¡Œé…ç½®ï¼š
![[Pasted image 20211114212447.png]]

7ã€ä½¿ç”¨å¤–éƒ¨Tomcaté‹è¡Œè©² war æ–‡ä»¶ï¼ˆæŠŠ war æ–‡ä»¶ç›´æ¥ä¸Ÿåˆ° tomcatçš„webappsç›®éŒ„ï¼Œå•Ÿå‹• tomcatï¼‰

**æ³¨æ„äº‹é …ï¼š**

å°‡é …ç›®æ‰“æˆwaråŒ…ï¼Œéƒ¨ç½²åˆ°å¤–éƒ¨çš„tomcatä¸­ï¼Œé€™å€‹æ™‚å€™ï¼Œä¸èƒ½ç›´æ¥è¨ªå•spring boot é …ç›®ä¸­é…ç½®æ–‡ä»¶é…ç½®çš„ç«¯å£ã€‚ application.ymlä¸­é…ç½®çš„server.porté…ç½®çš„æ˜¯spring bootå…§ç½®çš„tomcatçš„ç«¯å£è™Ÿ, æ‰“æˆwaråŒ…éƒ¨ç½²åœ¨ç¨ç«‹çš„tomcatä¸Šä¹‹å¾Œ, é…ç½®çš„server.portæ˜¯ä¸èµ·ä½œç”¨çš„ã€‚ä¸€å®šè¦æ³¨æ„é€™ä¸€é»ï¼ ï¼


### 5.1.3 jaråŒ…å’ŒwaråŒ…æ–¹å¼å°æ¯”

1ã€SpringBooté …ç›®æ‰“åŒ…æ™‚èƒ½æ‰“æˆ jar èˆ‡ waråŒ…ï¼Œå°æ¯”å…©ç¨®æ‰“åŒ…æ–¹å¼:

 jaræ›´åŠ ç°¡å–®æ–¹ä¾¿ï¼Œä½¿ç”¨ java -jar xx.jar å°±å¯ä»¥å•Ÿå‹•ã€‚æ‰€ä»¥æ‰“æˆ jar åŒ…çš„æœ€å¤šã€‚
 
 è€Œ waråŒ…å¯ä»¥éƒ¨ç½²åˆ°tomcatçš„ webapps ä¸­ï¼Œéš¨Tomcatçš„å•Ÿå‹•è€Œå•Ÿå‹•ã€‚å…·é«”ä½¿ç”¨å“ªç¨®æ–¹å¼ï¼Œæ‡‰è¦–æ‡‰ç”¨å ´æ™¯è€Œå®šã€‚
 
2ã€æ‰“jaråŒ…æ™‚ä¸æœƒæŠŠsrc/main/webapp ä¸‹çš„å…§å®¹æ‰“åˆ°jaråŒ…è£¡ (ä½ èªç‚ºçš„æ‰“åˆ°jaråŒ…è£¡é¢ï¼Œè·¯å¾‘æ˜¯ä¸è¡Œçš„æœƒå ±404)

 æ‰“waråŒ…æ™‚æœƒæŠŠsrc/main/webapp ä¸‹çš„å…§å®¹æ‰“åˆ°waråŒ…è£¡
 
3ã€æ‰“æˆä»€éº¼æ–‡ä»¶åŒ…é€²è¡Œéƒ¨ç½²èˆ‡é …ç›®æ¥­å‹™æœ‰é—œï¼Œå°±åƒæä¾› rest æœå‹™çš„é …ç›®éœ€è¦æ‰“åŒ…æˆ jaræ–‡ä»¶ï¼Œç”¨å‘½ä»¤é‹è¡Œå¾ˆæ–¹ä¾¿ã€‚ ã€‚ ã€‚è€Œæœ‰å¤§é‡cssã€jsã€htmlï¼Œä¸”éœ€è¦ç¶“å¸¸æ”¹å‹•çš„é …ç›®ï¼Œæ‰“æˆ war åŒ…å»é‹è¡Œæ¯”è¼ƒæ–¹ä¾¿ï¼Œå› ç‚ºæ”¹å‹•éœæ…‹è³‡æºå¯ä»¥ç›´æ¥è¦†è“‹ï¼Œå¾ˆå¿«çœ‹åˆ°æ”¹å‹•å¾Œçš„æ•ˆæœï¼Œé€™æ˜¯ jar åŒ…ä¸èƒ½æ¯”çš„

ï¼ˆèˆ‰å€‹â€˜æ —â€™å­ï¼šé …ç›®æ‰“æˆ jar åŒ…é‹è¡Œï¼Œä¸€æ®µæ™‚é–“å¾Œï¼Œå‰ç«¯è¦å°å…¶ä¸­æŸå¹¾å€‹é é¢æ¨£å¼é€²è¡Œæ”¹å‹•ï¼Œä½¿å…¶æ›´ç¾è§€ï¼Œé‚£éº¼æ”¹å‹•å¹¾å€‹cssã€htmlå¾Œï¼Œéœ€è¦é‡æ–°æ‰“æˆä¸€å€‹æ–°çš„ jar åŒ…ï¼Œä¸Šå‚³æœå‹™å™¨ä¸¦é‹è¡Œï¼Œé€™ç¨®æ”¹å‹•é »ç¹æ™‚å¾ˆä¸å‹å¥½ï¼Œæ–‡ä»¶å¤§æ™‚ä¸Šå‚³æœå‹™å™¨å¾ˆè€—æ™‚ï¼Œé‚£éº¼ waråŒ…å°±èƒ½å…å»é€™ç¨®ç…©æƒ±ï¼Œåªè¦è¦†è“‹å¹¾å€‹cssèˆ‡htmlå³å¯ï¼‰


### 5.1.4 å¤šç’°å¢ƒéƒ¨ç½²
åœ¨é …ç›®é‹è¡Œä¸­ï¼ŒåŒ…æ‹¬å¤šç¨®ç’°å¢ƒï¼Œä¾‹å¦‚ç·šä¸Šç’°å¢ƒprod(product)ã€é–‹ç™¼ç’°å¢ƒdev(development)ã€æ¸¬è©¦ç’°å¢ƒtestã€ææ¸¬ç’°å¢ƒqaã€å–®å…ƒæ¸¬è©¦unitestç­‰ç­‰ã€‚ä¸åŒçš„ç’°å¢ƒéœ€è¦é€²è¡Œä¸åŒçš„é…ç½®ï¼Œå¾è€Œåœ¨ä¸åŒçš„å ´æ™¯ä¸­è·‘æˆ‘å€‘çš„ç¨‹åºã€‚ä¾‹å¦‚prodç’°å¢ƒå’Œdevç’°å¢ƒé€šå¸¸éœ€è¦é€£æ¥ä¸åŒçš„æ•¸æ“šåº«ã€éœ€è¦é…ç½®ä¸åŒçš„æ—¥èªŒè¼¸å‡ºé…ç½®ã€‚é‚„æœ‰ä¸€äº›é¡å’Œæ–¹æ³•ï¼Œåœ¨ä¸åŒçš„ç’°å¢ƒä¸‹æœ‰ä¸åŒçš„å¯¦ç¾æ–¹å¼ã€‚

Spring Boot å°æ­¤æä¾›äº†æ”¯æŒï¼Œä¸€æ–¹é¢æ˜¯è¨»è§£@Profileï¼Œå¦ä¸€æ–¹é¢é‚„æœ‰å¤šè³‡æºé…ç½®æ–‡ä»¶ã€‚

#### @Profile
@profile è¨»è§£çš„ä½œç”¨æ˜¯æŒ‡å®šé¡æˆ–æ–¹æ³•åœ¨ç‰¹å®šçš„ Profile ç’°å¢ƒç”Ÿæ•ˆï¼Œä»»ä½• @Component æˆ–@Configuration è¨»è§£çš„é¡éƒ½å¯ä»¥ä½¿ç”¨ @Profile è¨»è§£ã€‚åœ¨ä½¿ç”¨DIä¾†ä¾è³´æ³¨å…¥çš„æ™‚å€™ï¼Œèƒ½å¤ æ ¹æ“š@profile æ¨™æ˜çš„ç’°å¢ƒï¼Œå°‡æ³¨å…¥ç¬¦åˆç•¶å‰é‹è¡Œç’°å¢ƒçš„ç›¸æ‡‰çš„beanã€‚

ä½¿ç”¨è¦æ±‚ï¼š

	@Component æˆ– @Configuration è¨»è§£çš„é¡å¯ä»¥ä½¿ç”¨ @profile
	@Profile ä¸­éœ€è¦æŒ‡å®šä¸€å€‹å­—ç¬¦ä¸²ï¼Œç´„å®šç”Ÿæ•ˆçš„ç’°å¢ƒ

1ã€ @Profile çš„ä½¿ç”¨ä½ç½®

ï¼ˆ1ï¼‰ @Prifile ä¿®é£¾é¡
```java
@Configuration
@Profile("prod")
public class JndiDataConfig {
	@Bean(destroyMethod="")
	public DataSource dataSource() throws Exception {
		Context ctx = new InitialContext();
		return (DataSource) ctx.lookup("java:comp/env/jdbc/datasource");
	}
}
```

ï¼ˆ2ï¼‰ @Profile ä¿®é£¾æ–¹æ³•
```java
@Configuration
public class AppConfig {
	@Bean("dataSource")
	@Profile("dev")
	public DataSource standaloneDataSource() {
		return new EmbeddedDatabaseBuilder()
		.setType(EmbeddedDatabaseType.HSQL)
		.addScript("classpath:com/bank/config/sql/schema.sql")
		.addScript("classpath:com/bank/config/sql/test-data.sql")
		.build();
	}
	@Bean("dataSource")
	@Profile("prod")
	public DataSource jndiDataSource() throws Exception {
		Context ctx = new InitialContext();
		return (DataSource) ctx.lookup("java:comp/env/jdbc/datasource");
	}
}
```

ï¼ˆ3ï¼‰ @Profile ä¿®é£¾è¨»è§£

@Profile è¨»è§£æ”¯æŒå®šç¾©åœ¨å…¶ä»–è¨»è§£ä¹‹ä¸Šï¼Œä»¥å‰µå»ºè‡ªå®šç¾©å ´æ™¯è¨»è§£ã€‚é€™æ¨£å°±å‰µå»ºäº†ä¸€å€‹ @Dev æ³¨è§£ï¼Œè©²è¨»è§£å¯ä»¥æ¨™è­˜beanä½¿ç”¨æ–¼ @Dev é€™å€‹å ´æ™¯ã€‚å¾ŒçºŒå°±ä¸å†éœ€è¦ä½¿ç”¨ @Profile("dev") çš„æ–¹å¼ï¼Œé€™æ¨£å³å¯ä»¥ç°¡åŒ–ä»£ç¢¼ã€‚
```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Profile("prod")
	public @interface Production {
}
```


2ã€profileæ¿€æ´»

å¯¦éš›ä½¿ç”¨ä¸­ï¼Œè¨»è§£ä¸­æ¨™ç¤ºäº†prodã€testã€qaç­‰å¤šå€‹ç’°å¢ƒï¼Œé‹è¡Œæ™‚ä½¿ç”¨å“ªå€‹profileç”±spring.profiles.activeæ§åˆ¶ï¼Œä»¥ä¸‹èªªæ˜2ç¨®æ–¹å¼ï¼šé…ç½®æ–‡ä»¶æ–¹å¼ã€å‘½ä»¤è¡Œæ–¹å¼ã€‚

ï¼ˆ1ï¼‰é…ç½®æ–‡ä»¶æ–¹å¼æ¿€æ´»profile

ç¢ºå®šç•¶å‰ä½¿ç”¨çš„æ˜¯å“ªå€‹ç’°å¢ƒï¼Œé€™é‚Šç’°å¢ƒçš„å€¼èˆ‡application-prod.propertiesä¸­-å¾Œé¢çš„å€¼å°æ‡‰ï¼Œé€™æ˜¯SpringBootç´„å®šå¥½çš„ã€‚

åœ¨resources/application.propertiesä¸­æ·»åŠ ä¸‹é¢çš„é…ç½®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œspring.profiles.activeçš„å–å€¼æ‡‰è©²èˆ‡ @Profile è¨»è§£ä¸­çš„æ¨™ç¤ºä¿æŒä¸€è‡´ã€‚
```properties
spring.profiles.active=dev
```

é™¤æ­¤ä¹‹å¤–ï¼ŒåŒç†é‚„å¯ä»¥åœ¨resources/application.ymlä¸­é…ç½®ï¼Œæ•ˆæœæ˜¯ä¸€æ¨£çš„ï¼š
```yml
spring:
	profiles:
		active: dev
```

ï¼ˆ2ï¼‰å‘½ä»¤è¡Œæ–¹å¼æ¿€æ´»profile

åœ¨æ‰“åŒ…å¾Œé‹è¡Œçš„æ™‚å€™ï¼Œæ·»åŠ åƒæ•¸ï¼š

java -jar spring-boot-config-0.0.1-SNAPSHOT.jar --spring.profiles.active=devï¼›

#### å¤šProfileçš„è³‡æºæ–‡ä»¶
é™¤äº†@profileè¨»è§£çš„å¯ä»¥æ¨™æ˜æŸäº›æ–¹æ³•å’Œé¡å…·é«”åœ¨å“ªå€‹ç’°å¢ƒä¸‹æ³¨å…¥ã€‚ springbootçš„ç’°å¢ƒéš”é›¢é‚„å¯ä»¥ä½¿ç”¨å¤šè³‡æºæ–‡ä»¶çš„æ–¹å¼ï¼Œé€²è¡Œä¸€äº›åƒæ•¸çš„é…ç½®ã€‚

â‘ è³‡æºé…ç½®æ–‡ä»¶

Springbootçš„è³‡æºé…ç½®æ–‡ä»¶é™¤äº†application.propertiesä¹‹å¤–ï¼Œé‚„å¯ä»¥æœ‰å°æ‡‰çš„è³‡æºæ–‡ä»¶ application-{profile}.propertiesã€‚

å‡è¨­ï¼Œä¸€å€‹æ‡‰ç”¨çš„å·¥ä½œç’°å¢ƒæœ‰ï¼šdevã€testã€prod

é‚£éº¼ï¼Œæˆ‘å€‘å¯ä»¥æ·»åŠ  4 å€‹é…ç½®æ–‡ä»¶ï¼š

	applcation.properties - å…¬å…±é…ç½®
	application-dev.properties - é–‹ç™¼ç’°å¢ƒé…ç½®
	application-test.properties - æ¸¬è©¦ç’°å¢ƒé…ç½®
	application-prod.properties - ç”Ÿç”¢ç’°å¢ƒé…ç½®

ä¸åŒçš„propertiesé…ç½®æ–‡ä»¶ä¹Ÿå¯ä»¥æ˜¯åœ¨ applcation.properties æ–‡ä»¶ä¸­ä¾†æ¿€æ´» profileï¼š

spring.profiles.active = test

â‘¡æ•ˆæœæ¼”ç¤º

ä»¥ä¸‹æ˜¯ä¸€å€‹å¤šå€‹è³‡æºé…ç½®æ–‡ä»¶çš„ä¾‹å­ï¼Œä¸»è¦å€åˆ†äº†é–‹ç™¼ç’°å¢ƒdevå’Œç·šä¸Šç’°å¢ƒprodã€‚
![[Pasted image 20211114213514.png]]

åœ¨controllerå±¤ä¸­çš„Sound.javaä¸­æ–°å»ºä¸€å€‹æ¥å£ï¼Œè¿”å›é…ç½®æ–‡ä»¶ä¸­çš„ä¿¡æ¯ï¼šnameå’Œlocalã€‚
```java
@Controller
@RequestMapping("/sound")
public class Sound {
	@Value("${com.name}")
	private String name;
	@Value("${com.location}")
	private String location;
	@RequestMapping("hello")
	@ResponseBody
	public String sound1(){
		System.out.println(name + "hello Spring Boot, " +location);
		return name + "ï¼Œhello Spring Bootï¼ " +location;
	}
}
```

application.propertiesæ–‡ä»¶å…§å®¹å¦‚ä¸‹ï¼š
```properties
## å¤šç¯å¢ƒé…ç½®æ–‡ä»¶æ¿€æ´»å±æ€§
spring.profiles.active=prod
```

application-dev.propertiesæ–‡ä»¶å…§å®¹å¦‚ä¸‹ï¼š
```properties
# æœåŠ¡ç«¯å£
server.port=1111
#å¯ä»¥å®šä¹‰ä¸€äº›è‡ªå·±ä½¿ç”¨çš„å±æ€§ï¼Œç„¶åé€šè¿‡@Value("${å±æ€§å}}")æ³¨è§£æ¥åŠ è½½å¯¹åº”çš„é…ç½®å±æ€§
com.name=DEV
com.location=Beijing
```

application-prod.propertiesæ–‡ä»¶å…§å®¹å¦‚ä¸‹ï¼š
```properties
server.port=2222
#å¯ä»¥å®šä¹‰ä¸€äº›è‡ªå·±ä½¿ç”¨çš„å±æ€§ï¼Œç„¶åé€šè¿‡@Value("${å±æ€§å}}")æ³¨è§£æ¥åŠ è½½å¯¹åº”çš„é…ç½®å±æ€§
com.name=Prod
com.location=Hubei
```

![[Pasted image 20211114213708.png]]


## 5.2 SpringBoot ç›£æ§
å¾®æœå‹™çš„ç‰¹é»æ±ºå®šäº†åŠŸèƒ½æ¨¡å¡Šçš„éƒ¨ç½²æ˜¯åˆ†ä½ˆå¼çš„ï¼Œå¤§éƒ¨åˆ†åŠŸèƒ½æ¨¡å¡Šéƒ½æ˜¯é‹è¡Œåœ¨ä¸åŒçš„æ©Ÿå™¨ä¸Šï¼Œå½¼æ­¤é€šéæœå‹™èª¿ç”¨é€²è¡Œäº¤äº’ï¼Œå‰å¾Œå°çš„æ¥­å‹™æµæœƒç¶“éå¾ˆå¤šå€‹å¾®æœå‹™çš„è™•ç†å’Œå‚³éï¼Œå‡ºç¾äº†ç•°å¸¸å¦‚ä½•å¿«é€Ÿ
å®šä½æ˜¯å“ªå€‹ç’°ç¯€å‡ºç¾äº†å•é¡Œï¼Ÿ

åœ¨é€™ç¨®æƒ…æ³ä¸‹ï¼Œå¾®æœå‹™çš„ç›£æ§é¡¯å¾—å°¤ç‚ºé‡è¦ã€‚ springbootä½œç‚ºå¾®æœå‹™æ¡†æ¶ï¼Œé™¤äº†å®ƒå¼·å¤§çš„å¿«é€Ÿé–‹ç™¼åŠŸèƒ½å¤–ï¼Œé‚„æœ‰å°±æ˜¯å®ƒæä¾›äº†actuatoræ¨¡å¡Šï¼Œå¼•å…¥è©²æ¨¡å¡Šèƒ½å¤ è‡ªå‹•ç‚ºspringbootæ‡‰ç”¨æä¾›ä¸€ç³»åˆ—ç”¨æ–¼ç›£æ§çš„ç«¯é»

### 5.2.1 Acturator
#### ä»€éº¼æ˜¯Actuator
 Actuatoræ˜¯spring bootçš„ä¸€å€‹é™„åŠ åŠŸèƒ½,å¯å¹«åŠ©ä½ åœ¨æ‡‰ç”¨ç¨‹åºç”Ÿç”¢ç’°å¢ƒæ™‚ç›£è¦–å’Œç®¡ç†æ‡‰ç”¨ç¨‹åºã€‚å¯ä»¥ä½¿ç”¨HTTPçš„å„ç¨®è«‹æ±‚ä¾†ç›£ç®¡,å¯©è¨ˆ,æ”¶é›†æ‡‰ç”¨çš„é‹è¡Œæƒ…æ³ã€‚ Spring Boot Actuatoræä¾›äº†å°å–®å€‹Spring Bootçš„ç›£æ§ï¼Œä¿¡æ¯åŒ…å«ï¼šæ‡‰ç”¨ç‹€æ…‹ã€å…§å­˜ã€ç·šç¨‹ã€å †æ£§ç­‰ç­‰ï¼Œæ¯”è¼ƒå…¨é¢çš„ç›£æ§äº†SpringBootæ‡‰ç”¨çš„æ•´å€‹ç”Ÿå‘½é€±æœŸã€‚ç‰¹åˆ¥å°æ–¼å¾®æœå‹™ç®¡ç†ååˆ†æœ‰æ„ç¾©ã€‚

#### Actuator çš„ REST æ¥å£
Actuator ç›£æ§åˆ†æˆå…©é¡ï¼šåŸç”Ÿç«¯é»å’Œç”¨æˆ¶è‡ªå®šç¾©ç«¯é»ï¼›è‡ªå®šç¾©ç«¯é»ä¸»è¦æ˜¯æŒ‡æ“´å±•æ€§ï¼Œç”¨æˆ¶å¯ä»¥æ ¹æ“šè‡ªå·±çš„å¯¦éš›æ‡‰ç”¨ï¼Œå®šç¾©ä¸€äº›æ¯”è¼ƒé—œå¿ƒçš„æŒ‡æ¨™ï¼Œåœ¨é‹è¡ŒæœŸé€²è¡Œç›£æ§ã€‚

åŸç”Ÿç«¯é»æ˜¯åœ¨æ‡‰ç”¨ç¨‹åºè£¡æä¾›çœ¾å¤š Web æ¥å£ï¼Œé€šéå®ƒå€‘äº†è§£æ‡‰ç”¨ç¨‹åºé‹è¡Œæ™‚çš„å…§éƒ¨ç‹€æ³ã€‚åŸç”Ÿç«¯é»åˆå¯ä»¥åˆ†æˆä¸‰é¡ï¼š

- æ‡‰ç”¨é…ç½®é¡ï¼šå¯ä»¥æŸ¥çœ‹æ‡‰ç”¨åœ¨é‹è¡ŒæœŸçš„éœæ…‹ä¿¡æ¯ï¼šä¾‹å¦‚è‡ªå‹•é…ç½®ä¿¡æ¯ã€åŠ è¼‰çš„ springbeanä¿¡æ¯ã€yml æ–‡ä»¶é…ç½®ä¿¡æ¯ã€ç’°å¢ƒä¿¡æ¯ã€è«‹æ±‚æ˜ å°„ä¿¡æ¯ï¼›
- åº¦é‡æŒ‡æ¨™é¡ï¼šä¸»è¦æ˜¯é‹è¡ŒæœŸçš„å‹•æ…‹ä¿¡æ¯ï¼Œä¾‹å¦‚å †æ£§ã€è«‹æ±‚éˆã€ä¸€äº›å¥åº·æŒ‡æ¨™ã€metrics ä¿¡æ¯ç­‰ï¼›
- æ“ä½œæ§åˆ¶é¡ï¼šä¸»è¦æ˜¯æŒ‡ shutdown,ç”¨æˆ¶å¯ä»¥ç™¼é€ä¸€å€‹è«‹æ±‚å°‡æ‡‰ç”¨çš„ç›£æ§åŠŸèƒ½é—œé–‰ã€‚

Actuator æä¾›äº† 13 å€‹æ¥å£ï¼Œå…·é«”å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚


HTTP æ–¹æ³• |è·¯å¾‘ |æè¿°
--|--|--
GET |/auditevents |é¡¯ç¤ºæ‡‰ç”¨æš´éœ²çš„å¯©è¨ˆäº‹ä»¶ (æ¯”å¦‚èªè­‰é€²å…¥ã€è¨‚å–®å¤±æ•—)
GET |/beans |æè¿°æ‡‰ç”¨ç¨‹åºä¸Šä¸‹æ–‡è£¡å…¨éƒ¨çš„ Beanï¼Œä»¥åŠå®ƒå€‘çš„é—œä¿‚
GET |/conditions |å°±æ˜¯ 1.0 çš„ /autoconfig ï¼Œæä¾›ä¸€ä»½è‡ªå‹•é…ç½®ç”Ÿæ•ˆçš„æ¢ä»¶æƒ…æ³ï¼Œè¨˜éŒ„å“ªäº›è‡ªå‹•é…ç½®æ¢ä»¶é€šéäº†ï¼Œå“ªäº›æ²’é€šé
GET |/configprops |æè¿°é…ç½®å±¬æ€§(åŒ…å«é»˜èªå€¼)å¦‚ä½•æ³¨å…¥Bean
GET |/env |ç²å–å…¨éƒ¨ç’°å¢ƒå±¬æ€§
GET |/env/{name} |æ ¹æ“šåç¨±ç²å–ç‰¹å®šçš„ç’°å¢ƒå±¬æ€§å€¼
GET |/flyway |æä¾›ä¸€ä»½ Flyway æ•¸æ“šåº«é·ç§»ä¿¡æ¯
GET |/liquidbase |é¡¯ç¤ºLiquibase æ•¸æ“šåº«é·ç§»çš„çº–ç´°ä¿¡æ¯
GET |/health |å ±å‘Šæ‡‰ç”¨ç¨‹åºçš„å¥åº·æŒ‡æ¨™ï¼Œé€™äº›å€¼ç”± HealthIndicator çš„å¯¦ç¾é¡æä¾›
GET |/heapdump dump |ä¸€ä»½æ‡‰ç”¨çš„ JVM å †ä¿¡æ¯
GET |/httptrace |é¡¯ç¤ºHTTPè¶³è·¡ï¼Œæœ€è¿‘100å€‹HTTP request/repsponse
GET |/info |ç²å–æ‡‰ç”¨ç¨‹åºçš„å®šåˆ¶ä¿¡æ¯ï¼Œé€™äº›ä¿¡æ¯ç”±infoæ‰“é ­çš„å±¬æ€§æä¾›
GET |/logfile |è¿”å›log fileä¸­çš„å…§å®¹(å¦‚æœ logging.file æˆ–è€… logging.path è¢«è¨­ç½®)
GET |/loggers |é¡¯ç¤ºå’Œä¿®æ”¹é…ç½®çš„loggers
GET |/metrics |å ±å‘Šå„ç¨®æ‡‰ç”¨ç¨‹åºåº¦é‡ä¿¡æ¯ï¼Œæ¯”å¦‚å…§å­˜ç”¨é‡å’ŒHTTPè«‹æ±‚è¨ˆæ•¸
GET |/metrics/{name} |å ±å‘ŠæŒ‡å®šåç¨±çš„æ‡‰ç”¨ç¨‹åºåº¦é‡å€¼
GET |/scheduledtasks |å±•ç¤ºæ‡‰ç”¨ä¸­çš„å®šæ™‚ä»»å‹™ä¿¡æ¯
GET |/sessions |å¦‚æœæˆ‘å€‘ä½¿ç”¨äº† Spring Session å±•ç¤ºæ‡‰ç”¨ä¸­çš„ HTTP sessions ä¿¡æ¯
POST |/shutdown |é—œé–‰æ‡‰ç”¨ç¨‹åºï¼Œè¦æ±‚endpoints.shutdown.enabledè¨­ç½®ç‚ºtrue
GET |/mappings |æè¿°å…¨éƒ¨çš„ URIè·¯å¾‘ï¼Œä»¥åŠå®ƒå€‘å’Œæ§åˆ¶å™¨(åŒ…å«Actuatorç«¯é»)çš„æ˜ å°„é—œä¿‚
GET |/threaddump |ç²å–ç·šç¨‹æ´»å‹•çš„å¿«ç…§

#### é«”é©—Actuator
ä½¿ç”¨ActuatoråŠŸèƒ½èˆ‡springBootä½¿ç”¨å…¶ä»–åŠŸèƒ½ä¸€æ¨£ç°¡å–®ï¼Œåªéœ€è¦åœ¨pom.xmlä¸­æ·»åŠ å¦‚ä¸‹ä¾è³´ï¼š
```xml
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
```

ç‚ºäº†ä¿è­‰ actuator æš´éœ²çš„ç›£æ§æ¥å£çš„å®‰å…¨æ€§ï¼Œéœ€è¦æ·»åŠ å®‰å…¨æ§åˆ¶çš„ä¾è³´ spring-boot-start security ä¾è³´ï¼Œè¨ªå•æ‡‰ç”¨ç›£æ§ç«¯é»æ™‚ï¼Œéƒ½éœ€è¦è¼¸å…¥é©—è­‰ä¿¡æ¯ã€‚ Security ä¾è³´ï¼Œå¯ä»¥é¸æ“‡ä¸åŠ ï¼Œä¸é€²è¡Œå®‰å…¨ç®¡ç†ã€‚

**é…ç½®æ–‡ä»¶**
```properties
info.app.name=spring-boot-actuator
info.app.version= 1.0.0
info.app.test=test
management.endpoints.web.exposure.include=*
#å±•ç¤ºç»†èŠ‚ï¼Œé™¤äº†alwaysä¹‹å¤–è¿˜æœ‰when-authorizedã€neverï¼Œé»˜è®¤å€¼æ˜¯never
management.endpoint.health.show-details=always
#management.endpoints.web.base-path=/monitor
management.endpoint.shutdown.enabled=true
```

- management.endpoints.web.base-path=/monitor ä»£è¡¨å•Ÿç”¨å–®ç¨çš„urlåœ°å€ä¾†ç›£æ§ Spring Boot æ‡‰ç”¨ï¼Œç‚ºäº†å®‰å…¨ä¸€èˆ¬éƒ½å•Ÿç”¨ç¨ç«‹çš„ç«¯å£ä¾†è¨ªå•å¾Œç«¯çš„ç›£æ§ä¿¡æ¯
- management.endpoint.shutdown.enabled=true å•Ÿç”¨æ¥å£é—œé–‰ Spring Boot

é…ç½®å®Œæˆä¹‹å¾Œï¼Œå•Ÿå‹•é …ç›®å°±å¯ä»¥ç¹¼çºŒé©—è­‰å„å€‹ç›£æ§åŠŸèƒ½äº†ã€‚

#### å±¬æ€§è©³è§£
åœ¨ Spring Boot 2.x ä¸­ç‚ºäº†å®‰å…¨æœŸé–“ï¼ŒActuator åªé–‹æ”¾äº†å…©å€‹ç«¯é» /actuator/health å’Œ /actuator/info ã€‚å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è¨­ç½®æ‰“é–‹ã€‚

å¯ä»¥æ‰“é–‹æ‰€æœ‰çš„ç›£æ§é»
```properties
management.endpoints.web.exposure.include=*
```

ä¹Ÿå¯ä»¥é€‰æ‹©æ‰“å¼€éƒ¨åˆ†
```properties
management.endpoints.web.exposure.include=beans,trace
```

Actuator é»˜èªæ‰€æœ‰çš„ç›£æ§é»è·¯å¾‘éƒ½åœ¨ /actuator/* ï¼Œç•¶ç„¶å¦‚æœæœ‰éœ€è¦é€™å€‹è·¯å¾‘ä¹Ÿæ”¯æŒå®šåˆ¶ã€‚
```properties
management.endpoints.web.base-path=/manage
```

è¨­ç½®å®Œé‡å•Ÿå¾Œï¼Œå†æ¬¡è¨ªå•åœ°å€å°±æœƒè®Šæˆ /manage/*

Actuator å¹¾ä¹ç›£æ§äº†æ‡‰ç”¨æ¶‰åŠçš„æ–¹æ–¹é¢é¢ï¼Œæˆ‘å€‘é‡é»è¬›è¿°ä¸€äº›ç¶“å¸¸åœ¨é …ç›®ä¸­å¸¸ç”¨çš„å±¬æ€§ã€‚

**health**

health ä¸»è¦ç”¨ä¾†æª¢æŸ¥æ‡‰ç”¨çš„é‹è¡Œç‹€æ…‹ï¼Œé€™æ˜¯æˆ‘å€‘ä½¿ç”¨æœ€é«˜é »çš„ä¸€å€‹ç›£æ§é»ã€‚é€šå¸¸ä½¿ç”¨æ­¤æ¥å£æé†’æˆ‘å€‘æ‡‰ç”¨å¯¦ä¾‹çš„é‹è¡Œç‹€æ…‹ï¼Œä»¥åŠæ‡‰ç”¨ä¸â€å¥åº·â€œçš„åŸå› ï¼Œæ¯”å¦‚æ•¸æ“šåº«é€£æ¥ã€ç£ç›¤ç©ºé–“ä¸å¤ ç­‰ã€‚

é»˜èªæƒ…æ³ä¸‹ health çš„ç‹€æ…‹æ˜¯é–‹æ”¾çš„ï¼Œæ·»åŠ ä¾è³´å¾Œå•Ÿå‹•é …ç›®ï¼Œè¨ªå•ï¼šhttp://localhost:8080/actuator/health å³å¯çœ‹åˆ°æ‡‰ç”¨çš„ç‹€æ…‹ã€‚

```json
{
	"status" : "UP"
}
```

health é€šéåˆä½µå¹¾å€‹å¥åº·æŒ‡æ•¸æª¢æŸ¥æ‡‰ç”¨çš„å¥åº·æƒ…æ³ã€‚ Spring Boot Actuator æœ‰å¹¾å€‹é å®šç¾©çš„å¥åº·æŒ‡æ¨™æ¯”å¦‚ DataSourceHealthIndicator , DiskSpaceHealthIndicator ,MongoHealthIndicator , RedisHealthIndicator ç­‰ï¼Œå®ƒä½¿ç”¨é€™äº›å¥åº·æŒ‡æ¨™ä½œç‚ºå¥åº·æª¢æŸ¥çš„ä¸€éƒ¨åˆ†ã€‚

èˆ‰å€‹ä¾‹å­ï¼Œå¦‚æœä½ çš„æ‡‰ç”¨ä½¿ç”¨ Redisï¼Œ RedisHealthindicator å°‡è¢«ç•¶ä½œæª¢æŸ¥çš„ä¸€éƒ¨åˆ†ï¼›å¦‚æœä½¿ç”¨ MongoDBï¼Œé‚£éº¼ MongoHealthIndicator å°‡è¢«ç•¶ä½œæª¢æŸ¥çš„ä¸€éƒ¨åˆ†ã€‚

å¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­é—œé–‰ç‰¹å®šçš„å¥åº·æª¢æŸ¥æŒ‡æ¨™ï¼Œæ¯”å¦‚é—œé–‰ redis çš„å¥åº·æª¢æŸ¥ï¼š
```properties
management.health.redise.enabled=false
```

é»˜èªï¼Œæ‰€æœ‰çš„é€™äº›å¥åº·æŒ‡æ¨™è¢«ç•¶ä½œå¥åº·æª¢æŸ¥çš„ä¸€éƒ¨åˆ†ã€‚

**info**

info å°±æ˜¯æˆ‘å€‘è‡ªå·±é…ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ä»¥ info é–‹é ­çš„é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚æˆ‘å€‘åœ¨ç¤ºä¾‹é …ç›®ä¸­çš„é…ç½®æ˜¯ï¼š
```properties
info.app.name=spring-boot-actuator
info.app.version= 1.0.0
info.app.test= test
```

å•Ÿå‹•ç¤ºä¾‹é …ç›®ï¼Œè¨ªå•ï¼š http://localhost:8080/actuator/info è¿”å›éƒ¨åˆ†ä¿¡æ¯å¦‚ä¸‹ï¼š
```json
{
	"app": {
		"name": "spring-boot-actuator",
		"version": "1.0.0",
		"test":"test"
	}
}
```

**beans**

æ ¹æ“šç¤ºä¾‹å°±å¯ä»¥çœ‹å‡ºï¼Œå±•ç¤ºäº† bean çš„åˆ¥åã€é¡å‹ã€æ˜¯å¦å–®ä¾‹ã€é¡çš„åœ°å€ã€ä¾è³´ç­‰ä¿¡æ¯ã€‚

å•Ÿå‹•ç¤ºä¾‹é …ç›®ï¼Œè¨ªå•ï¼š http://localhost:8080/actuator/beans è¿”å›éƒ¨åˆ†ä¿¡æ¯å¦‚ä¸‹ï¼š
```json
[
	{
		"context": "application:8080:management",
		"parent": "application:8080",
		"beans": [
		{
			"bean": "embeddedServletContainerFactory",
			"aliases": [
			],
			"scope": "singleton",
			"type":	"org.springframework.boot.context.embedded.tomcat.TomcatEmbeddedServletContainerFactory",
			"resource": "null",
			"dependencies": [
			]
		},
		{
			"bean": "endpointWebMvcChildContextConfiguration",
			"aliases": [
			],
			"scope": "singleton",
			"type":	"org.springframework.boot.actuate.autoconfigure.EndpointWebMvcChildContextConfiguration$$EnhancerBySpringCGLIB$$a4a10f9d",
			"resource": "null",
			"dependencies": [
			]
		}
	}
]
```

##conditions##
Spring Boot çš„è‡ªå‹•é…ç½®åŠŸèƒ½éå¸¸ä¾¿åˆ©ï¼Œä½†æœ‰æ™‚å€™ä¹Ÿæ„å‘³è‘—å‡ºå•é¡Œæ¯”è¼ƒé›£æ‰¾å‡ºå…·é«”çš„åŸå› ã€‚ä½¿ç”¨conditions å¯ä»¥åœ¨æ‡‰ç”¨é‹è¡Œæ™‚æŸ¥çœ‹ä»£ç¢¼äº†æŸå€‹é…ç½®åœ¨ä»€éº¼æ¢ä»¶ä¸‹ç”Ÿæ•ˆï¼Œæˆ–è€…æŸå€‹è‡ªå‹•é…ç½®ç‚ºä»€éº¼
æ²’æœ‰ç”Ÿæ•ˆã€‚

å•Ÿå‹•ç¤ºä¾‹é …ç›®ï¼Œè¨ªå•ï¼š http://localhost:8080/actuator/conditions è¿”å›éƒ¨åˆ†ä¿¡æ¯å¦‚ä¸‹ï¼š
```json
{
	"positiveMatches": {
		"DevToolsDataSourceAutoConfiguration": {
			"notMatched": [
				{
					"condition":
					"DevToolsDataSourceAutoConfiguration.DevToolsDataSourceCondition",
					"message": "DevTools DataSource Condition did not find a single DataSource bean"
				}
			],
			"matched": [ ]
		},
		"RemoteDevToolsAutoConfiguration": {
			"notMatched": [
				{
					"condition": "OnPropertyCondition",
					"message": "@ConditionalOnProperty(spring.devtools.remote.secret) did not find property 'secret'
				}
			],
			"matched": [
				{
					"condition": "OnClassCondition",
					"message": "@ConditionalOnClass found required classes'javax.servlet.Filter', 'org.springframework.http.server.ServerHttpRequest';@ConditionalOnMissingClass did not find unwanted class"
				}
			]
		}
	}
}
```

**heapdump**

è¿”å›ä¸€å€‹ GZip å£“ç¸®çš„ JVM å † dump

å•Ÿå‹•ç¤ºä¾‹é …ç›®ï¼Œè¨ªå•ï¼š http://localhost:8080/actuator/heapdump æœƒè‡ªå‹•ç”Ÿæˆä¸€å€‹ Jvm çš„å †æ–‡ä»¶ heapdumpï¼Œæˆ‘å€‘å¯ä»¥ä½¿ç”¨ JDK è‡ªå¸¶çš„ Jvm ç›£æ§å·¥å…· VisualVM æ‰“é–‹æ­¤æ–‡ä»¶æŸ¥çœ‹å…§å­˜å¿«ç…§ã€‚

é¡ä¼¼å¦‚ä¸‹åœ–ï¼š
![[Pasted image 20211114215441.png]]

**mappings**

æè¿°å…¨éƒ¨çš„ URI è·¯å¾‘ï¼Œä»¥åŠå®ƒå€‘å’Œæ§åˆ¶å™¨çš„æ˜ å°„é—œä¿‚

å•Ÿå‹•ç¤ºä¾‹é …ç›®ï¼Œè¨ªå•ï¼š http://localhost:8080/actuator/mappings è¿”å›éƒ¨åˆ†ä¿¡æ¯å¦‚ä¸‹ï¼š
```json
{
	"/**/favicon.ico": {
		"bean": "faviconHandlerMapping"
	},
	"{[/hello]}": {
		"bean": "requestMappingHandlerMapping",
		"method": "public java.lang.String com.neo.controller.HelloController.index()"
	},
	"{[/error]}": {
		"bean": "requestMappingHandlerMapping",
		"method": "public	org.springframework.http.ResponseEntity<java.util.Map<java.lang.String,	java.lang.Object>>org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.		servlet.http.HttpServletRequest)"
	}
}
```


**threaddump**

/threaddump æ¥å£æœƒç”Ÿæˆç•¶å‰ç·šç¨‹æ´»å‹•çš„å¿«ç…§ã€‚é€™å€‹åŠŸèƒ½éå¸¸å¥½ï¼Œæ–¹ä¾¿æˆ‘å€‘åœ¨æ—¥å¸¸å®šä½å•é¡Œçš„æ™‚å€™æŸ¥çœ‹ç·šç¨‹çš„æƒ…æ³ã€‚ä¸»è¦å±•ç¤ºäº†ç·šç¨‹åã€ç·šç¨‹IDã€ç·šç¨‹çš„ç‹€æ…‹ã€æ˜¯å¦ç­‰å¾…é–è³‡æºç­‰ä¿¡æ¯ã€‚

å•Ÿå‹•ç¤ºä¾‹é …ç›®ï¼Œè¨ªå•ï¼š http://localhost:8080/actuator/threaddump è¿”å›éƒ¨åˆ†ä¿¡æ¯å¦‚ä¸‹ï¼š
```json
[
	{
		"threadName": "http-nio-8088-exec-6",
		"threadId": 49,
		"blockedTime": -1,
		"blockedCount": 0,
		"waitedTime": -1,
		"waitedCount": 2,
		"lockName":
		"java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@1630a501",
		"lockOwnerId": -1,
		"lockOwnerName": null,
		"inNative": false,
		"suspended": false,
		"threadState": "WAITING",
		"stackTrace": [
			{
			"methodName": "park",
			"fileName": "Unsafe.java",
			"lineNumber": -2,
			"className": "sun.misc.Unsafe",
			"nativeMethod": true
			},
			...
			{
			"methodName": "run",
			"fileName": "TaskThread.java",
			"lineNumber": 61,
			"className":
			"org.apache.tomcat.util.threads.TaskThread$WrappingRunnable",
			"nativeMethod": false
			}
			...
		],
		"lockInfo": {
			"className":
			"java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject",
			"identityHashCode": 372286721
		}
	}
	...
]
```

ç”Ÿç”¢å‡ºç¾å•é¡Œçš„æ™‚å€™ï¼Œå¯ä»¥é€šéæ‡‰ç”¨çš„ç·šç¨‹å¿«ç…§ä¾†æª¢æ¸¬æ‡‰ç”¨æ­£åœ¨åŸ·è¡Œçš„ä»»å‹™ã€‚

**shutdown**

é–‹å•Ÿæ¥å£å„ªé›…é—œé–‰ Spring Boot æ‡‰ç”¨ï¼Œè¦ä½¿ç”¨é€™å€‹åŠŸèƒ½é¦–å…ˆéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­é–‹å•Ÿï¼š
```properties
management.endpoint.shutdown.enabled=true
```

é…ç½®å®Œæˆä¹‹å¾Œï¼Œå•Ÿå‹•ç¤ºä¾‹é …ç›®ï¼Œä½¿ç”¨ curl æ¨¡æ“¬ post è«‹æ±‚è¨ªå• shutdown æ¥å£ã€‚

	shutdown æ¥å£é»˜èªåªæ”¯æŒ post è«‹æ±‚ã€‚

```log
curl -X POST "http://localhost:8080/actuator/shutdown"
{
"message": "Shutting down, bye..."
}
```

æ­¤æ™‚ä½ æœƒç™¼ç¾æ‡‰ç”¨å·²ç¶“è¢«é—œé–‰ã€‚

### 5.2.2 Spring Boot Admin
#### ä»€éº¼æ˜¯Spring Boot Admin
	å°æ–¼spring actuatorè€Œè¨€ï¼Œæœ€å¤§çš„ç¼ºé»åœ¨æ–¼æ˜¯ä»¥jsonå½¢å¼ä¾†é€²è¡Œå±•ç¤ºï¼Œç‚ºäº†æ›´å¥½çš„é€²è¡Œç›£æ§é¡¯ç¤ºï¼Œæˆ‘å€‘ä¾†ä»‹ç´¹ä¸€å€‹æ›´åŠ æ–¹ä¾¿çš„å·¥å…·ï¼šspring boot adminã€‚
	
	Spring Boot Adminï¼šå¯è¦–åŒ–å¾Œå°ç®¡ç†ç³»çµ±

Spring Boot Admin æ˜¯ä¸€å€‹é‡å°spring-bootçš„actuatoræ¥å£é€²è¡ŒUIç¾åŒ–å°è£çš„ç›£æ§å·¥å…·ã€‚ä»–å¯ä»¥è¿”å›åœ¨åˆ—è¡¨ä¸­ç€è¦½æ‰€æœ‰è¢«ç›£æ§spring-booté …ç›®çš„åŸºæœ¬ä¿¡æ¯æ¯”å¦‚ï¼šSpringå®¹å™¨ç®¡ç†çš„æ‰€æœ‰çš„beanã€è©³ç´°çš„Healthä¿¡æ¯ã€å…§å­˜ä¿¡æ¯ã€JVMä¿¡æ¯ã€åƒåœ¾å›æ”¶ä¿¡æ¯ã€å„ç¨®é…ç½®ä¿¡æ¯ï¼ˆæ¯”å¦‚æ•¸æ“šæºã€ç·©å­˜åˆ—è¡¨å’Œå‘½ä¸­ç‡ï¼‰ç­‰ï¼ŒThreads ç·šç¨‹ç®¡ç†ï¼ŒEnvironment ç®¡ç†ç­‰ã€‚

åˆ©ç”¨springbootadminé€²è¡Œç›£æ§çš„æ¶æ§‹åœ–å¦‚ä¸‹ï¼š
![[Pasted image 20211114215958.png]]

springbootadminç›£æ§

	é€šä¿—é»ï¼Œå°±æ˜¯æˆ‘å€‘å¦‚æœæœ‰nå€‹springbootæ¥­å‹™ç³»çµ±éœ€è¦ç›£æ§çš„è©±ï¼Œé‚£éº¼éœ€è¦ä¸€å€‹é¡å¤–çš„springbootadminæ‡‰ç”¨ä¾†é€²è¡Œç›£æ§é€™äº›clientï¼Œclientå’Œserverä¹‹é–“éœ€è¦åšä¸€é»é…ç½®å³å¯ã€‚

#### æ­å»ºServerç«¯
**pom.xml**
```xml
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-web</artifactId>
</dependency>
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
<dependency>
	<groupId>de.codecentric</groupId>
	<artifactId>spring-boot-admin-starter-server</artifactId>
</dependency>
```

**applicaiton.yml**
```yml
server:
	port: 8081
```

**@EnableAdminServer**
```java
@EnableAdminServer
@SpringBootApplication
public class App {
	public static void main(String[] args) {
		SpringApplication.run(App.class, args);
	}

```

**å•Ÿå‹•æœå‹™ç«¯ï¼š**
![[Pasted image 20211114220249.png]]

ç›®å‰clientç›£æ§ä¿¡æ¯ç‚ºç©º

#### æ­å»ºclientç«¯
**pom.xml**
```xml
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-web</artifactId>
</dependency>
<dependency>
	<groupId>org.springframework.boot</groupId>
	<artifactId>spring-boot-starter-actuator</artifactId>
</dependency>
<dependency>
	<groupId>de.codecentric</groupId>
	<artifactId>spring-boot-admin-starter-client</artifactId>
	<version>2.1.0</version>
</dependency>

```

**application.yml**
```yml
server:
	port: 8080
	#è‡ªå®šä¹‰é…ç½®ä¿¡æ¯ç”¨äº"/actuator/info"è¯»å–
info:
	name: è€ç‹
	age: 100
	phone: 110
	
#é€šè¿‡ä¸‹é¢çš„é…ç½®å¯ç”¨æ‰€æœ‰çš„ç›‘æ§ç«¯ç‚¹ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›ç«¯ç‚¹æ˜¯ç¦ç”¨çš„ï¼›
management:
	endpoints:
		web:
			exposure:
				include: "*"
	endpoint:
		health:
			show-details: always
			
## å°†Clientä½œä¸ºæœåŠ¡æ³¨å†Œåˆ°Serverï¼Œé€šè¿‡Serveræ¥ç›‘å¬é¡¹ç›®çš„è¿è¡Œæƒ…å†µ
spring:
	boot:
		admin:
			client:
				url: http://localhost:8081
				
##applicationå®ä¾‹å
	application:
		name : spring-boot-admin-client
```

**app.java**
```java
@RestController
@SpringBootApplication
public class App {
	public static void main(String[] args) {
		SpringApplication.run(App.class, args);
	}
	@RequestMapping("/index")
	public String index() {
		return "è¿™æ˜¯ index";
	}
	@RequestMapping("/home")
	public String home() {
		return "è¿™æ˜¯ home";
	}
}
```

å•Ÿå‹• clientâ€¦â€¦

å¹¾ç§’å¾Œåˆ·æ–°ï¼Œå¯ä»¥çœ‹åˆ° client ç«¯å·²è¨»å†Šåˆ° serverã€‚
![[Pasted image 20211114220624.png]]

æŸ¥çœ‹ client è©³ç´°ä¿¡æ¯ï¼š
![[Pasted image 20211114220642.png]]

























