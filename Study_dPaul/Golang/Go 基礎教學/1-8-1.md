---
Date: 2021-10-22
aliases: ["Defer"]
---

# Metadata

**Title** 	  :: Defer

**Author** :: #dPaulLai 

**Classification** :: #Learn #Go #Basic 

**Status**  :: #ğŸŒ 

**Type** 	:: #Note 

**Previous** :: 

**ParentNode** :: [[Go åŸºç¤æ•™å­¸]]

---

[defer](https://draveness.me/golang/docs/part2-foundation/ch05-keyword/golang-defer/)

# èµ„æºç®¡ç†

Go è¯­è¨€çš„ `defer` ä¼šåœ¨å½“å‰å‡½æ•°è¿”å›å‰æ‰§è¡Œä¼ å…¥çš„å‡½æ•°ï¼Œ
å®ƒä¼šç»å¸¸è¢«ç”¨äºå…³é—­æ–‡ä»¶æè¿°ç¬¦ã€å…³é—­æ•°æ®åº“è¿æ¥ä»¥åŠè§£é”èµ„æºã€‚

ä½œä¸ºä¸€ä¸ªç¼–ç¨‹è¯­è¨€ä¸­çš„å…³é”®å­—ï¼Œ`defer` çš„å®ç°ä¸€å®šæ˜¯ç”±ç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶å…±åŒå®Œæˆçš„ï¼Œ
ä¸è¿‡åœ¨æ·±å…¥æºç åˆ†æå®ƒçš„å®ç°ä¹‹å‰æˆ‘ä»¬è¿˜æ˜¯éœ€è¦äº†è§£ `defer` å…³é”®å­—çš„å¸¸è§ä½¿ç”¨åœºæ™¯ä»¥åŠä½¿ç”¨æ—¶çš„æ³¨æ„äº‹é¡¹ã€‚

Ex : å›æ»šæ•°æ®åº“çš„äº‹åŠ¡

```go
func createPost(db *gorm.DB) error {
    tx := db.Begin()
    defer tx.Rollback()
    if err := tx.Create(&Post{Author: "Draveness"}).Error; err != nil {
        return err
    }
    return tx.Commit().Error
}
```

åœ¨ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šé¢çš„ä»£ç åœ¨åˆ›å»ºäº‹åŠ¡åå°±ç«‹åˆ»è°ƒç”¨ `Rollback` ä¿è¯äº‹åŠ¡ä¸€å®šä¼šå›æ»šã€‚å“ªæ€•äº‹åŠ¡çœŸçš„æ‰§è¡ŒæˆåŠŸäº†ï¼Œé‚£ä¹ˆè°ƒç”¨ `tx.Commit()` ä¹‹åå†æ‰§è¡Œ `tx.Rollback()` ä¹Ÿä¸ä¼šå½±å“å·²ç»æäº¤çš„äº‹åŠ¡ã€‚

## ç°è±¡

- `defer` å…³é”®å­—çš„è°ƒç”¨æ—¶æœºä»¥åŠå¤šæ¬¡è°ƒç”¨ `defer` æ—¶æ‰§è¡Œé¡ºåºæ˜¯å¦‚ä½•ç¡®å®šçš„ï¼›
- `defer` å…³é”®å­—ä½¿ç”¨ä¼ å€¼çš„æ–¹å¼ä¼ é€’å‚æ•°æ—¶ä¼šè¿›è¡Œé¢„è®¡ç®—ï¼Œå¯¼è‡´ä¸ç¬¦åˆé¢„æœŸçš„ç»“æœï¼›

### ä½œç”¨åŸŸ

å‘ `defer` å…³é”®å­—ä¼ å…¥çš„å‡½æ•°ä¼šåœ¨å‡½æ•°è¿”å›ä¹‹å‰è¿è¡Œã€‚

###
